# DVWA-Brute Force



## low 

爆破我建議用其他zap，burp免費版太慢了。
fuzzer 功能然後選擇字典 rockyou.txt


```http=
GET http://dvwa.com/vulnerabilities/brute/?username=admin&password=password&Login=Login HTTP/1.1
host: dvwa.com
User-Agent: Mozilla/5.0 (Windows NT 6.1; Win64; x64; rv:109.0) Gecko/20100101 Firefox/115.0
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,*/*;q=0.8
Accept-Language: zh-TW,zh;q=0.8,en-US;q=0.5,en;q=0.3
Connection: keep-alive
Referer: http://dvwa.com/vulnerabilities/brute/
Cookie: PHPSESSID=4i4libn0314pggpe1njpdot3ht; security=low
Upgrade-Insecure-Requests: 1

```

## medium 

主要加上了2秒拖時間，前面還有一些防止sql注入的手段，所以爆破長一點



```php=
<?php

if( isset( $_GET[ 'Login' ] ) ) {
    // Sanitise username input
    $user = $_GET[ 'username' ];
    $user = ((isset($GLOBALS["___mysqli_ston"]) && is_object($GLOBALS["___mysqli_ston"])) ? mysqli_real_escape_string($GLOBALS["___mysqli_ston"],  $user ) : ((trigger_error("[MySQLConverterToo] Fix the mysql_escape_string() call! This code does not work.", E_USER_ERROR)) ? "" : ""));

    // Sanitise password input
    $pass = $_GET[ 'password' ];
    $pass = ((isset($GLOBALS["___mysqli_ston"]) && is_object($GLOBALS["___mysqli_ston"])) ? mysqli_real_escape_string($GLOBALS["___mysqli_ston"],  $pass ) : ((trigger_error("[MySQLConverterToo] Fix the mysql_escape_string() call! This code does not work.", E_USER_ERROR)) ? "" : ""));
    $pass = md5( $pass );

    // Check the database
    $query  = "SELECT * FROM `users` WHERE user = '$user' AND password = '$pass';";
    $result = mysqli_query($GLOBALS["___mysqli_ston"],  $query ) or die( '<pre>' . ((is_object($GLOBALS["___mysqli_ston"])) ? mysqli_error($GLOBALS["___mysqli_ston"]) : (($___mysqli_res = mysqli_connect_error()) ? $___mysqli_res : false)) . '</pre>' );

    if( $result && mysqli_num_rows( $result ) == 1 ) {
        // Get users details
        $row    = mysqli_fetch_assoc( $result );
        $avatar = $row["avatar"];

        // Login successful
        echo "<p>Welcome to the password protected area {$user}</p>";
        echo "<img src=\"{$avatar}\" />";
    }
    else {
        // Login failed
        sleep( 2 );
        echo "<pre><br />Username and/or password incorrect.</pre>";
    }

    ((is_null($___mysqli_res = mysqli_close($GLOBALS["___mysqli_ston"]))) ? false : $___mysqli_res);
}

?> 
```








## high 



這題又要回到 burp 原因是zap 似乎有anti token 腳本，但我沒用過，不能開箱用，那乾脆自己用小工具跑，或是自己寫，最方便就是burp插件，不過要pro版爆破速度才會快

- CSRF TOKEN TRACKER
```
HOST: dvwa.com
Name: user_token
```


- OK
```
GET /vulnerabilities/brute/index.php?username=admin&password=password&Login=Login&user_token=644ec806024f41a21a78f59b9f093dcc HTTP/1.1
Host: dvwa.com
User-Agent: Mozilla/5.0 (Windows NT 6.1; Win64; x64; rv:109.0) Gecko/20100101 Firefox/115.0
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,*/*;q=0.8
Accept-Language: zh-TW,zh;q=0.8,en-US;q=0.5,en;q=0.3
Accept-Encoding: gzip, deflate, br
Connection: keep-alive
Referer: http://dvwa.com/vulnerabilities/brute/index.php
Cookie: PHPSESSID=qctav9d3a0bflucctqj55uo22f; security=high
Upgrade-Insecure-Requests: 1


```




## impossible


不但有CSRF 還有3次錯誤就鎖15分鐘，$account_locked = true才可以在次請求。
```
    $total_failed_login = 3;
    $lockout_time       = 15;
    $account_locked     = false;
```

很煩。無解