# DVWA-File Upload


## low 

直接上傳test.txt

任何檔案都可以上傳，而且他告訴你上傳位置。

正常不可能告訴你上傳位置。

```
../../hackable/uploads/test.txt succesfully uploaded!
```







## medium 

直接上傳test.txt
```
Your image was not uploaded. We can only accept JPEG or PNG images.
```


把test.txt 改成 test.txt.jpg 改包去掉.jpg 可以繞過。


他是判斷 content-type。而這是由前端選擇檔案來產生的，所以改副檔名最快。




## high

`getimagesize()` 是一个 PHP 函数，用于获取图像文件的尺寸和图像类型。它的语法如下：

```php
getimagesize(string $filename, array &$imageinfo): array|false
```

- `$filename` 是要检查的图像文件的路径。
- `$imageinfo` 是一个数组，用于存储图像的详细信息，例如尺寸、图像类型等。
- 函数返回一个包含图像尺寸信息的数组，或者在失败时返回 `false`。




所以我們要製作圖片馬，將圖片和代碼綁在一起。


命令，兩個都可以
```
copy dog.jpg/b+ hack.php new_dog.jpg


copy dog.jpg/b+ hack.txt new_dog2.jpg
```


這邊即使上傳也沒用，後端只會解析成圖片，不會解析為php


除非搭配 file include 才能使用。













## impossible


加密檔案名，攻擊者找不到圖片馬。
```
 $target_file   =  md5( uniqid() . $uploaded_name ) . '.' . $uploaded_ext; 
```

另外通过 `imagecreatefromjpeg()` 函数创建图像资源对象 `$img` 时，PHP GD 库会尝试解析 JPEG 图像文件，并将其转换为图像资源对象。在这个过程中，GD 库会尝试去解析图像文件的结构，以便将其转换为 PHP 可以操作的图像资源对象。

虽然 `imagecreatefromjpeg()` 函数本身不是专门用于检测或阻止图像马的，但在尝试解析图像文件时，PHP GD 库会对图像文件的结构进行一些基本的检查。如果图像文件损坏或包含不符合 JPEG 格式规范的内容，解析过程可能会失败，并返回 `false`。

因此，虽然 `imagecreatefromjpeg()` 函数不能完全防止图像马，但它可能会在尝试解析恶意图像文件时发现问题，并因此失败，从而间接地阻止了图像马的上传和处理。








