# DVWA-JavaScript Attacks

# low 

關鍵JS
```javascript=
// 定義一個函數 generate_token，用於生成令牌。該函數從 id 為 "phrase" 的輸入框中獲取短語，將其進行 ROT13 加密後再使用 MD5 哈希函數進行處理。
function generate_token() {
    // 獲取 id 為 "phrase" 的輸入框中的值。
    var phrase = document.getElementById("phrase").value;
    // 將經過 ROT13 加密的短語使用 MD5 哈希函數進行處理，並將結果設置為 id 為 "token" 的輸入框的值。
    document.getElementById("token").value = md5(rot13(phrase));
}

// 呼叫 generate_token 函數，以便在頁面加載時生成令牌。
generate_token();
```
token 都一樣，而且是前端生成的
```
//純字串
ChangeMe

//在rot13
PunatrZr

//在md5
8b479aefbd90795395b3e7089ae0dc09
```
改成
```
//純字串
success

//在rot13
fhpprff

//在md5
38581812b435834ebf84ebcc2c6424d6
```

成功
```http=
POST /vulnerabilities/javascript/ HTTP/1.1
Host: dvwa.com
User-Agent: Mozilla/5.0 (Windows NT 6.1; Win64; x64; rv:109.0) Gecko/20100101 Firefox/115.0
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,*/*;q=0.8
Accept-Language: zh-TW,zh;q=0.8,en-US;q=0.5,en;q=0.3
Accept-Encoding: gzip, deflate, br
Content-Type: application/x-www-form-urlencoded
Content-Length: 65
Origin: http://dvwa.com
Connection: close
Referer: http://dvwa.com/vulnerabilities/javascript/
Cookie: security=low; PHPSESSID=m8dha5228gm795rgpmv0msbdhd
Upgrade-Insecure-Requests: 1

token=38581812b435834ebf84ebcc2c6424d6&phrase=success&send=Submit
```







# medium 


關鍵JS 生成token
```
//顛倒數字
function do_something(e) {
    for (var t = "", n = e.length - 1; n >= 0; n--) t += e[n];
    return t
}



setTimeout(function() {
    do_elsesomething("XX")
}, 300);




function do_elsesomething(e) {
    document.getElementById("token").value = do_something(e + document.getElementById("phrase").value + "XX")
}


```


抓包看到
```
token=XXeMegnahCXX&phrase=success&send=Submit
```


所以概念是 123 -> XX321XX
```
POST /vulnerabilities/javascript/ HTTP/1.1
Host: dvwa.com
User-Agent: Mozilla/5.0 (Windows NT 6.1; Win64; x64; rv:109.0) Gecko/20100101 Firefox/115.0
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,*/*;q=0.8
Accept-Language: zh-TW,zh;q=0.8,en-US;q=0.5,en;q=0.3
Accept-Encoding: gzip, deflate, br
Content-Type: application/x-www-form-urlencoded
Content-Length: 46
Origin: http://dvwa.com
Connection: close
Referer: http://dvwa.com/vulnerabilities/javascript/
Cookie: PHPSESSID=7abil7fdqh470nfetmf4e3lt2f; security=medium
Upgrade-Insecure-Requests: 1

token=XXsseccusXX&phrase=success&send=Submit

```





# high




這題需要解碼。
http://deobfuscatejavascript.com/#

關鍵代碼
```
function do_something(e) {
    for (var t = "", n = e.length - 1; n >= 0; n--) t += e[n];
    return t
}


function token_part_3(t, y = "ZZ") {
    document.getElementById("token").value = sha256(document.getElementById("token").value + y)
}


function token_part_2(e = "YY") {
    document.getElementById("token").value = sha256(e + document.getElementById("token").value)
}


function token_part_1(a, b) {
    document.getElementById("token").value = do_something(document.getElementById("phrase").value)
}


document.getElementById("phrase").value = "";
setTimeout(function() {
    token_part_2("XX")
}, 300);


document.getElementById("send").addEventListener("click", token_part_3);
token_part_1("ABCD", 44);
```

先去更改html 
```
<input type="text" name="phrase" value="success" id="phrase">
```

主控台
```
token_part_1("ABCD", 44);
token_part_2("XX")
```


點擊提交成功。




# impossible

```
You can never trust anything that comes from the user or prevent them from messing with it and so there is no impossible level.

```