# Red Team Recon




**偵察（recon）可分為兩部分：**

1. 被動偵察：可以透過被動觀看來進行
2. 主動偵察：需要與目標互動以激發它以觀察其反應。


### 主動偵察可分為：

**外部偵察**：
在目標網路之外進行，重點關注可透過網路評估的外部資產。一個例子是從公司網路外部運行 Nikto。

**內部偵察**：
從目標公司的網路內部進行。換句話說，滲透測試人員或紅隊測試人員可能實際位於公司大樓內。在這種情況下，他們可能正在目標網路上使用被利用的主機。一個例子是使用 Nessus 透過目標電腦之一掃描內部網路。




---
## 內建工具

線上 whois 網站icann (優先)比較詳細。
https://lookup.icann.org/en/lookup



**whois**
```
whois thmredteam.com
```



**dig 工具**
```
dig clinic.thmredteam.com @1.1.1.1
dig clinic.thmredteam.com A
dig clinic.thmredteam.com AAAA
dig clinic.thmredteam.com MX
dig clinic.thmredteam.com CNAME


```


**nslookup**
```
nslookup cafe.thmredteam.com


Non-authoritative answer:
Name:	cafe.thmredteam.com
Address: 104.21.93.169
Name:	cafe.thmredteam.com
Address: 172.67.212.249
Name:	cafe.thmredteam.com
Address: 2606:4700:3034::ac43:d4f9
Name:	cafe.thmredteam.com
Address: 2606:4700:3034::6815:5da9

```


**host**

```
host cafe.thmredteam.com

cafe.thmredteam.com has address 104.21.93.169
cafe.thmredteam.com has address 172.67.212.249
cafe.thmredteam.com has IPv6 address 2606:4700:3034::ac43:d4f9
cafe.thmredteam.com has IPv6 address 2606:4700:3034::6815:5da9

```





**traceroute**

* 有些路由器不會回應 發送的資料包
```
traceroute cafe.thmredteam.com


traceroute to cafe.thmredteam.com (172.67.212.249), 30 hops max, 60 byte packets
 1  RT-AC66U_B1-5D78 (192.168.50.1)  1.673 ms  1.752 ms  1.753 ms
 2  h254.s98.ts.hinet.net (168.95.98.254)  17.459 ms  17.540 ms  17.515 ms
 3  pcpc-3331.hinet.net (168.95.22.90)  18.668 ms  18.745 ms  18.716 ms
 4  tyfo-3031.hinet.net (220.128.5.62)  19.330 ms  19.443 ms  19.522 ms
 5  tyfo-4011.hinet.net (220.128.8.69)  19.392 ms tyfo-4011.hinet.net (220.128.8.73)  19.365 ms  19.809 ms
 6  r31-la.us.hinet.net (202.39.91.5)  152.292 ms  148.838 ms  149.110 ms
 7  * * r32-la.us.hinet.net (202.39.84.86)  144.967 ms
 8  141.101.72.250 (141.101.72.250)  172.314 ms  163.801 ms  163.815 ms
 9  172.70.208.2 (172.70.208.2)  151.007 ms 141.101.72.32 (141.101.72.32)  161.337 ms 162.158.88.3 (162.158.88.3)  147.144 ms
10  172.67.212.249 (172.67.212.249)  146.514 ms  146.646 ms  146.624 ms

```


---


## 進階搜尋


```
filetype:pdf
doc, docx, ppt, pptx, xls and xlsx.



site:blog.tryhackme.com


intitle:TryHackMe


inurl:tryhackme
```


**語法表**
```
DuckDuckGo 語法:
https://duckduckgo.com/duckduckgo-help-pages/results/syntax/



Bing 語法:
https://support.microsoft.com/zh-tw/topic/%E9%80%B2%E4%BD%8D%E6%90%9C%E5%B0%8B%E9%81%B8%E9%A0%85-b92e25f1-0085-4271-bdf9-14aaea720930


GHDB
https://www.exploit-db.com/google-hacking-database
```





**您將如何使用 Google 搜尋 xls http://clinic.thmredteam.com 的索引？**

```
filetype:xls site:clinic.thmredteam.com  
```


**passwords 您將如何使用 Google 搜尋包含http://clinic.thmredteam.com一詞的檔案 ？**

```
"passwords" site:clinic.thmredteam.com  
```



---

## 社群媒體

```
領英
推特
Facebook
Instagram
```
徵才廣告
* 請注意，  Wayback Machine有助於擷取客戶網站上職缺頁面的先前版本。

---




## 專業搜尋引擎

ViewDNS.info
```
https://viewdns.info/
```

威脅情報平台 免費版本可能包括一些基本的威脅情報資料
```
https://threatintelligenceplatform.com/
```


censys 的免費訂閱方案通常提供基本的功能
```
https://search.censys.io/
```

Shodan.io
```
https://www.shodan.io/
```




```
https://threatintelligenceplatform.com/report/cafe.thmredteam.com/8eTbOJjIQK

當我們搜尋 時cafe.thmredteam.com，我們還可以獲得同一 IP 位址上的其他網域的清單

找到 cafe.thmredteam.com 解析出兩個IP
104.21.93.169
172.67.212.249
```


------------------------------------------------------

## Recon-ng


創建工作區，(最好是同個目標相關的工作區)
```
cmd進入創建 thmredteam
recon-ng -w thmredteam

或是進入recon-ng再創建
workspaces create thmredteam
//會叫你輸入，domain

workspaces load thmredteam
```





**搜尋插件市場**
```
marketplace search domains-
marketplace search virustotal
```

* 從列*下可以看出的那樣K。這個要求表明，除非我們有使用相關服務的金鑰，否則該模組不可用。





**查看模組**
```
marketplace info recon/domains-hosts/google_site_web
marketplace info recon/domains-hosts/netcraft
marketplace info recon/hosts-hosts/virustotal
marketplace info recon/domains-hosts/mx_spf_ip
```




**安裝模組**
```
marketplace install recon/domains-contacts/whois_pocs
marketplace install google_site_web
marketplace install netcraft
marketplace install migrate_hosts
marketplace install recon/domains-hosts/mx_spf_ip
```


**刪除模組**
marketplace remove migrate_hosts




**取得所有已安裝模組的列表**
```
modules search
```



**將特定模組載入到內存**
```
modules load google_site_web 
modules load netcraft
modules load mx_spf_ip
modules load whois_pocs
```



**設定模組參數**
```
goptions <list|set|unset>
```


**input 可以查看多少目標需要被運行**



**執行**
```
run
show hosts
```


**DB相關操作**
```
db schema
db query select * from domains;
db query select * from hosts;
db query insert into domains (domain) values ('bbd53.com.tw');
db query delete from domains where domain = 'bbd53.com.tw';
```


---







## Maltego CE (免費版)

### !!!小坑，開啟後，需要login會卡住，原因是預設瀏覽器，你可以調成自己的例如google。


### 優點

* **圖形化和預設模塊非常好用，但是缺點是高版本比較能自動化，這點 recon-ng 贏了。**
作為新手，優先使用這個，等到熟練後，再轉去 recon-ng。


* **常用操作**
左側 infrastructure -> domain (拉到空白處) -> 右鍵展開 (DNS from domain)  -> To DNS Name (SecurityTrails)。這相當於去 SecurityTrails的庫找到一堆子域名。


* **建議用列表顯示，比較舒服。**


* **若不懂模塊，可以右鍵說明，會跳轉官網文件。**



* 注意:我實測直接去 SecurityTrails的庫找能多找到一點子域名，Maltego的SecurityTrails庫似乎沒有同步跟新。



**答案**
```
查詢 NIST 國家漏洞資料庫的轉換名稱是什麼？

https://www.maltego.com/transform-hub/
搜尋NIST

正解:NIST NVD





提供基於 ATT&CK 的轉換的專案名稱是什麼？

打開Maltego 搜尋ATT&CK

正解:MISP Project
```



















































