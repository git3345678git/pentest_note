# CDN 

## 設置教學
https://www.youtube.com/watch?v=7Yh38M-Az0k



當您將新網站新增至 Cloudflare 時，Cloudflare會自動掃描常見記錄

替換為 Cloudflare 的 nameservers中的名稱伺服器名稱


一旦您将域名的域名服务器更改为 Cloudflare 提供的域名服务器，Godaddy 面板上的 DNS 记录将不再起作用。域名服务器的更改意味着 DNS 解析和流量路由现在由 Cloudflare 负责，而不再由 Godaddy 或任何其他以前的 DNS 服务提供商负责。

在这种情况下，Godaddy 面板上的 DNS 记录将被忽略，并且不会影响您的域名的 DNS 解析。所有的 DNS 查询都将被转发到 Cloudflare 提供的域名服务器上，根据您在 Cloudflare 控制面板中设置的 DNS 记录进行处理。

因此，您应该在 Cloudflare 控制面板中管理您的 DNS 记录，并确保所有必要的记录都正确配置和更新。如果您需要对 DNS 记录进行任何更改，您应该在 Cloudflare 控制面板中进行，而不是在 Godaddy 面板上进行。



如果您有在旧的域名服务器上设置了一些自定义配置或记录，例如 MX 记录、CNAME 记录等，您可能需要将这些配置迁移到Cloudflare提供的管理界面中




| 记录类型          | 正常的记录值              | 加上 CDN 后的记录值               |
|----------------|-----------------------|-------------------------------|
| A              | 43.21.11.3             | Cloudflare 分配的 IP 地址           |
| AAAA           | 2001:0db8:85a3:0000:0000:8a2e:0370:7334 | Cloudflare 分配的 IPv6 地址     |
| CNAME          | www.example.com       | CNAME 到 Cloudflare 提供的 CDN 地址 |
| MX             | mail.example.com      | mail.example.com              |
| TXT            | "v=spf1 mx -all"      | SPF 記錄等                    |
| SRV            | _sip._tcp.example.com | SRV 記錄等                    |
| NS             | NS1.EXAMPLE.COM       | NS1.CLOUDFLARE.COM            |
|                | NS2.EXAMPLE.COM       | NS2.CLOUDFLARE.COM            |





總而言之，当您将域名的 DNS 记录指向 CDN 提供商提供的域名服务器时，A 记录将不再指向您原始站点的 IP 地址，而是指向 CDN 的边缘节点的 IP 地址。这样做的目的是让所有的用户请求都通过 CDN 的网络进行处理，从而实现内容的缓存、加速和优化。

通过将 A 记录指向 CDN 的边缘节点，用户的请求将被路由到离他们更近的 CDN 节点，从而降低延迟并提高网站的性能。CDN 的边缘节点会缓存您的网站内容，并根据用户的位置和请求情况来动态调整内容分发策略，以提供最佳的用户体验。



## 驗證是否使用CDN:

目標: www.tianshie.com

### DNS record
```
www.tianshie.com.	300	IN	A	 	172.67.208.184
www.tianshie.com.	300	IN	A	 	104.21.69.132
www.tianshie.com.	300	IN	AAAA	 	2606:4700:3033::ac43:d0b8
www.tianshie.com.	300	IN	AAAA	 	2606:4700:3030::6815:4584
```

A記錄通常指向 CDN 節點，而不是原站IP了



### 直接連
```
http://172.67.208.184/


Cache-Control: private, max-age=0, no-store, no-cache, must-revalidate, post-check=0, pre-check=0
CF-RAY: 8608e8bd9bf114e9-LAX
Connection: close
Content-Encoding: gzip
Content-Type: text/html; charset=UTF-8
Date: Thu, 07 Mar 2024 07:35:30 GMT
Expires: Thu, 01 Jan 1970 00:00:01 GMT
Referrer-Policy: same-origin
Server: cloudflare
Transfer-Encoding: chunked
Vary: Accept-Encoding
X-Frame-Options: SAMEORIGIN



cf-ray 头部是 Cloudflare 为每个请求生成的唯一标识符。它用于标识请求经过的 Cloudflare 边缘节点
```







### 正常連網
```
https://www.tianshie.com/


access-control-allow-origin: https://www.tianshie.com
alt-svc: h3=":443"; ma=86400
cache-control: max-age=3, must-revalidate
cf-cache-status: DYNAMIC
cf-ray: 8608ddec8cb72b97-LAX
content-encoding: br
content-type: text/html; charset=UTF-8
date: Thu, 07 Mar 2024 07:28:08 GMT
nel: {"success_fraction":0,"report_to":"cf-nel","max_age":604800}
report-to: {"endpoints":[{"url":"https:\/\/a.nel.cloudflare.com\/report\/v3?s=u7S%2FczSkkRo%2FuavbSk1ndPHbYimA7zTrXzguV5na9bWbViOQt%2BAkJNHPVw%2FbEtnqWiv791ZIzqbagLTerEUgn%2B5FxTqh0jYPz3vK%2FUyF7S135piMPWNnXFiReLsW7jfhqifz"}],"group":"cf-nel","max_age":604800}
server: cloudflare
strict-transport-security: max-age=63072000; includeSubdomains; preload
vary: Accept-Encoding, Accept-Encoding, Cookie


cf-cache-status: DYNAMIC：
这个头部表示 Cloudflare 边缘节点处理的响应是动态生成的，并且没有在边缘节点的缓存中找到匹配的内容。这意味着该响应是直接从您的原始服务器获取的，而不是从 Cloudflare 的缓存中提供的。

cf-ray: 8608ddec8cb72b97-LAX：
这个头部是 Cloudflare 为每个请求生成的唯一标识符，用于标识请求经过的 Cloudflare 边缘节点。在这个例子中，8608ddec8cb72b97 是请求的唯一标识符，LAX 表示请求经过的 Cloudflare 边缘节点位于洛杉矶（Los Angeles）。

原因免费版的 CloudFlare 方案并不缓存超过 512 MB 的文件。
（512 MB 其实超级大了，佛心公司；升级成付费版则可以缓存高达 5 GB 的文件）
```
也就是有些資料還是從原站拿到的，沒有完全緩存。




## Reverse IP Lookup A記錄 會出現一大堆站
```
172.67.208.184
104.21.69.132



01marry.cn	2024-03-01
078qq.com	2024-02-29
0ole7f.shop	2022-11-07
130qqeast.com	2024-02-29
1ironworker.xyz	2024-03-05
1smzj.fun	2022-08-11
1wlvaf.top	2024-02-08
2828sj.sbs	2022-10-17
294332.com	2024-02-29
299451.xyz	2022-07-05
3730-178.com	2024-02-29
3gpixxx.com	2024-02-29
43odance.shop	2022-11-21
52fenomentv.xyz	2023-12-10
5m.sbs	2021-12-02
95zz28.com	2023-12-05
9702211.xyz	2022-06-10
9k.gg	2023-10-31
ab281.com	2024-02-29
 
```



隨便挑 1ironworker.xyz 的 NS 記錄
```
1ironworker.xyz.	1800	IN	SOA	 	candy.ns.cloudflare.com. dns.cloudflare.com. 2333984339 10000 2400 604800 1800
1ironworker.xyz.	21600	IN	NS	 	candy.ns.cloudflare.com.
1ironworker.xyz.	21600	IN	NS	 	jaime.ns.cloudflare.com.
1ironworker.xyz.	300	IN	A	 	104.21.69.132
1ironworker.xyz.	300	IN	A	 	172.67.208.184
1ironworker.xyz.	300	IN	AAAA	 	2606:4700:3033::ac43:d0b8
1ironworker.xyz.	300	IN	AAAA	 	2606:4700:3030::6815:4584
```


隨便挑 benkel138super.online 的 NS 記錄
```
benkel138super.online.	1800	IN	SOA	 	lorna.ns.cloudflare.com. dns.cloudflare.com. 2334536575 10000 2400 604800 1800
benkel138super.online.	21600	IN	NS	 	lorna.ns.cloudflare.com.
benkel138super.online.	21600	IN	NS	 	nicolas.ns.cloudflare.com.
benkel138super.online.	300	IN	A	 	172.67.208.184
benkel138super.online.	300	IN	A	 	104.21.69.132
benkel138super.online.	300	IN	AAAA	 	2606:4700:3030::6815:4584
benkel138super.online.	300	IN	AAAA	 	2606:4700:3033::ac43:d0b8
```

也就是說 大家都經過CDN節點
```
1ironworker.xyz

benkel138super.online

www.tianshie.com
```



## 線上驗證工具:


https://www.cdnplanet.com/tools/cdnfinder/

https://builtwith.com/