

## 當我們發現使用CDN或是反向代理時，我們無法找到真實IP

```
dmoe.in

104.21.54.34    cloudflare
172.67.223.28   cloudflare
```



### 我們會尋找domain歷史IP。

線上工具
```
https://viewdns.info/iphistory/

https://myssl.com/cdn_check.html

https://whoisfreaks.com/tools/user/dns/history/lookup

https://osint.sh/dnshistory/

```

也就是domain歷史上的 DNS 記錄，A AAAA MX ....

- 但很多IP
- 已經過期，換別的域名
- 或是又是CDN
- 或者是代理
- 或者是share hosting
- 或是IP需要host
- 或是IP可以直接連


### 首先要有個觀念是，域名過期不IP不一定會跟著過期，也就是不一定需要域名單純IP也可以提供服務。




## IP是否可以透過反解，這邊要搞清楚2種反解

### 1.ptr記錄(沒用)
acg1080.com 的網域購買者，可以 更動PTR 記錄嗎

一般情况下，域名的购买者（也就是域名的注册人）无法直接更改 PTR 记录。PTR 记录是由 IP 地址的控制者（通常是网络服务提供商或数据中心）配置和管理的，通常是在 IP 地址所属的网络设备或网络服务提供商的 DNS 设置中进行配置。

域名的购买者可以控制和管理域名的 DNS 记录，例如 A 记录、CNAME 记录、MX 记录等，但他们无法直接更改与 IP 地址相关联的 PTR 记录。要更改 PTR 记录，购买者通常需要联系 IP 地址的控制者（即网络服务提供商或数据中心），请求他们进行更改。

總之就是ISP商的相關宣告類的，對滲透測試沒有太大幫助


很多時候 IP沒有ptr記錄，
```
book123.info A 74.48.27.144
74.48.27.144 ptr 卻沒有
```

- 所以不要用ptr判斷


### 2.蒐集歷史上的 domain 對應 A 記錄的Reverse IP Lookup(有用)

1.先找尋歷史IP

```
dmoe.in 
----------------------------------------

找了很多DNS DB去掉cdn的只有這個IP
65.108.74.52	09 Jun 2022


78.46.230.46 德国 2022-02-23


178.128.168.168 希腊 2023-03-28

```


2.反解IP，反解釋到目前為止的蒐集到的A記錄對應domain

利用web服務查看業務是否同性質，近期可以用fofa比對，遠期可以使用wayback，比對web服務
```
65.108.74.52	09 Jun 2022
//反解沒hostname記錄



78.46.230.46 德国 2022-02-23
frawards.mpass.gr
mikmori.com	  2015



178.128.168.168 希腊 2023-03-28
178.128.168.168.dsl.dyn.forthnet.gr
mail.thaianthro.com
staging.find-mushroom.com

```

篩選出來 65.108.74.52 因為反解沒hostname記錄，我們上fofa找端口
```
https://65.108.74.52:8006/
彈出了一個HEL6 - Proxmox Virtual Environment 登入介面，雖然可疑，有可能，但我覺得，不太像同個作者況且IP在Finland 
```

到這歷史IP檢查結束。


### FOFA 進階



```
"dmoe.in"
搜尋最多，最雜，包誇title favicon  body ip reverse  ltd 至換


找到 "dmoe.us"  198.27.67.8 確定是同一個業務

//會出現很多導航站，是因為他會透過body 搜尋，所以要會過濾，
"暗♥萌" 

//加上title 過濾
title = "暗♥萌"

//加上title 過濾
title = "暗萌"

//icon
icon_hash="841078825"
icon_hash="612829381"


找到新子域
https://pic.downcc.life
https://pic.dmoe.in
172.67.188.86    cloudflare

```


瀏覽 downcc.life 正在出售！所以尋找 downcc.life 歷史
wayback 尋找2023 是同個業務，2024出售。

```
可是這三個都 share hosting 。
91.195.240.12     30 Oct 2023
199.59.243.225    12 Jan 2024
3.64.163.50       2024-03-05


//嘗試過各種組合都失敗。
ip="91.195.240.12" && "downcc"
ip="91.195.240.12" && icon_hash="612829381"
ip="91.195.240.12" && icon_hash="841078825"
ip="199.59.243.225" && icon_hash="841078825"
```


fofa "downcc.life"

找到舊的 shared hosting 
```
cpanel.downcc.life
m.downcc.life
webmail.downcc.life
www.downcc.life
downcc.life
mail.downcc.life
pic.downcc.life
autodiscover.downcc.life
cpcontacts.downcc.life
cpcalendars.downcc.life
webdisk.downcc.life
smtp.downcc.life

```


至換域名，拿去 大量dns解析，沒有新發現
```
cpanel.dmoe.in
m.dmoe.in
webmail.dmoe.in
www.dmoe.in
dmoe.in
mail.dmoe.in
pic.dmoe.in
autodiscover.dmoe.in
cpcontacts.dmoe.in
cpcalendars.dmoe.in
webdisk.dmoe.in
smtp.dmoe.in


cpanel.dmoe.us
m.dmoe.us
webmail.dmoe.us
www.dmoe.us
dmoe.us
mail.dmoe.us
pic.dmoe.us
autodiscover.dmoe.us
cpcontacts.dmoe.us
cpcalendars.dmoe.us
webdisk.dmoe.us
smtp.dmoe.us
```