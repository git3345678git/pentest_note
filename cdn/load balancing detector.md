# LBD 


https://github.com/craig/ge.mine.nu/tree/master/lbd

```
lbd - 负载平衡检测器 0.4 - 检查给定域是否使用负载平衡。
                                     作者：Stefan Behte (http://ge.mine.nu)
                                     概念验证！ 可能会给出误报。

检查 DNS-Loadbalancing:host: 非法选项 -- h
用法：主机 [-aCdilrTvVw] [-c 类别] [-N ndots] [-t 类型] [-W 时间]
             [-R 编号] [-m 标志] [-p 端口] 主机名 [服务器]
        -a 相当于 -v -t ANY
        -A 类似于 -a 但省略 RRSIG、NSEC、NSEC3
        -c 指定非IN数据的查询类
        -C 比较权威名称服务器上的 SOA 记录
        -d 相当于 -v
        -l 使用 AXFR 列出域中的所有主机
        -m 设置内存调试标志（跟踪|记录|使用情况）
        -N 更改完成根查找之前允许的点数
        -p 指定要查询的服务器上的端口
        -r 禁用递归处理
        -R 指定UDP数据包的重试次数
        -s SERVFAIL 响应应停止查询
        -t 指定查询类型
        -T 启用 TCP/IP 模式
        -U 启用UDP模式
        -v 启用详细输出
        -V 打印版本号并退出
        -w 指定永远等待回复
        -W 指定等待回复的时间
        -4 仅使用 IPv4 查询传输
        -6 仅使用 IPv6 查询传输
  未找到
检查 HTTP 负载平衡 [服务器]：
```



這個 `lbd` 工具使用了三種不同的方式來檢測負載均衡：

1. **DNS-Loadbalancing**：這個方法試圖查找網站的 DNS A 記錄以確定是否有多個 IP 地址與該網站相關聯。如果發現多個 IP 地址，這可能表明 DNS 負載均衡已經配置。


```
Checking for DNS-Loadbalancing: FOUND
eyny.com has address 52.117.224.156
eyny.com has address 52.117.224.157
eyny.com has address 172.241.24.65
eyny.com has address 52.117.224.148
eyny.com has address 52.117.224.158
eyny.com has address 169.60.163.103
eyny.com has address 52.117.224.146
eyny.com has address 172.241.24.66
eyny.com has address 52.117.224.149
eyny.com has address 172.241.24.22
eyny.com has address 52.117.224.151
eyny.com has address 172.241.24.20

```





2. **HTTP-Loadbalancing [Server]**：通過檢查 HTTP 響應頭中的服務器信息，尋找不同的服務器版本或類型。如果發現不同版本的 Web 服務器，這可能表明網站正在使用多個後端伺服器。


```
Checking for HTTP-Loadbalancing [Server]:
Apache/1.3.33 (Unix) PHP/4.3.11
Apache/1.3.34 (Unix) PHP/4.3.11
Apache/2.2.0 (Unix) PHP/4.4.2
FOUND
```


3. **HTTP-Loadbalancing [Date]**：觀察 HTTP 響應的日期時間，尋找多個請求中的時間差異。如果在短時間內多次請求中發現不同的日期時間，這可能表明不同的請求被分發到了不同的伺服器上。



假設我們有以下請求的回應時間：

```
請求1: 18:00:01
請求2: 18:00:03
請求3: 18:00:02
請求4: 18:00:04
```

在這個例子中，請求2的回應時間早於請求3和請求4，這表明請求2可能被分發到了另一個伺服器上，
並且該伺服器的回應時間較短。這種情況暗示著可能存在負載均衡，即請求被分發到了多個伺服器上以平衡負載。

```
Checking for HTTP-Loadbalancing [Date]: 18:30:45, 18:30:46, 18:30:47, 18:30:48, 18:30:49, 18:30:50, 18:30:51, 18:30:51, 18:30:53, 18:30:53, 18:30:54, 18:30:55, 18:30:57, 18:30:57, 18:30:58, 18:30:59, 18:31:01, 18:31:01, 18:31:02, 18:31:03, 18:31:04, 18:31:05, 18:31:06, 18:31:07, 18:31:08, 18:31:09, 18:31:10, 18:31:11, 18:31:12, 18:31:13, 18:31:13, 18:31:14, 18:31:15, 18:31:16, 18:31:17, 18:31:18, 18:31:19, 18:31:20, 18:31:21, 18:31:22, 18:31:23, 18:31:25, 18:31:26, 18:31:26, 18:31:27, 18:31:28, 18:31:30, 18:31:30, 18:31:31, 18:31:33, NOT FOUND



Checking for HTTP-Loadbalancing [Date]: 18:32:56, 18:32:56, 18:32:57, 18:32:58, 18:32:58, 18:32:59, 18:33:00, 18:33:00, 18:33:01, 18:33:02, 18:33:02, 18:33:03, 18:33:04, 18:33:04, 18:33:05, 18:33:06, 18:33:05, FOUND


```




4. **HTTP-Loadbalancing [Diff]**：比較不同請求的 HTTP 響應內容，尋找內容的差異。特別是在服務器信息和其他標頭中，如果發現內容的差異，這可能表明不同的請求被分發到了不同的伺服器上。

這些方法組合起來提供了一個綜合的檢測過程，以確定網站是否使用了負載均衡技術。然而，需要注意的是，這些方法都是基於觀察 HTTP 響應和 DNS 記錄來進行的，可能會受到網站配置、網絡環境和其他因素的影響，可能會給出假陽性或假陰性的結果。


長度判斷
```
Checking for HTTP-Loadbalancing [Diff]: FOUND
< Content-Length: 23012
> Content-Length: 23011

```

比對 http 是否一樣
```
Checking for HTTP-Loadbalancing [Diff]: FOUND
< Report-To: {"endpoints":[{"url":"https:\/\/a.nel.cloudflare.com\/report\/v3?s=2acTAeZ5e2OK7fxo7J2r%2F7xnd7YbcdDcYEjNgvu7xq31antCOEeqZZmfLznIJacgoJjkaL1QXLdOJBdIrPN3JfQsFt9wY%2FR9Orltw4TkBie1O9eKiJ3iSrKOxc3AwJiLYvCY1J4vJw%3D%3D"}],"group":"cf-nel","max_age":604800}
> Report-To: {"endpoints":[{"url":"https:\/\/a.nel.cloudflare.com\/report\/v3?s=c6DmNG4v%2F%2FbGCVCXRCWpvFC5C3l2HZCK8XGks%2FPEm%2BewKKn7dHSfKeHCGeg4EVwawPmt7e%2B4yu99hHlL1FWJ4AZzpub%2F63ZNT%2F3OwS9EjfjtCtUdNMlS8Sk3Du3sdHjgVZt4d%2BTF%2BA%3D%3D"}],"group":"cf-nel","max_age":604800}
< CF-RAY: 861b8c22ab8b832f-KIX
> CF-RAY: 861b8c243c35852f-HKG


```


## 可以為基本判斷，但不準確

- DNS-Loadbalancing
這點基本上可以判斷，dns 查到很多A記錄，可以代表輪播，但有可能使用了CDN CDN有時會把A記錄指向CDN商的dns，但CDN也算均衡的一種。


- HTTP-Loadbalancing [Server]
這點不錯，兩台不同的服務器，可以很簡單判斷使用了DNS

然後他是用 telnet exapmle.com 80 這樣去判斷的。




- HTTP-Loadbalancing [Date]
這點也是有可能，假設發兩個request ， 
request1  response1 1:35，
request2 response1 1:32
request2 先確先收到。

代表兩個請求，可能不是送到同一台機器。



- HTTP-Loadbalancing [Diff]
也是可以參考
比對http頭不一樣，不一定代表有。搞不好整個網頁，每個時段的網頁內容不一樣。



## 心得

不是很好用，有太多地方需要人工排查，但是可以做一個觀察點。