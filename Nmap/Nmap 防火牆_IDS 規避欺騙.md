# Nmap防火牆/IDS 規避欺騙





1. **IDS（入侵檢測系統）**：
   - **功能**：IDS 主要用於監控網絡流量和系統活動，以檢測異常或潛在的入侵行為。
   - **工作方式**：IDS 通常通過監視網絡流量和系統日誌來檢測威脅。它可以識別已知的攻擊模式、行為異常或其他潛在的安全風險。
   - **反應**：IDS 主要提供警報功能，當檢測到異常行為時，會生成警報通知安全人員進行進一步調查和應對。

2. **IPS（入侵防禦系統）**：
   - **功能**：IPS 在 IDS 的基礎上添加了防禦功能，不僅能夠檢測入侵行為，還能夠主動阻止或阻擋攻擊。
   - **工作方式**：IPS 在檢測到入侵行為後，會自動採取行動來阻止攻擊，例如阻擋惡意流量、關閉受感染的主機端口等。
   - **反應**：與 IDS 不同，IPS 不僅提供警報通知，還能夠主動阻止入侵行為，以保護系統和網絡安全。

簡而言之，IDS 主要用於檢測入侵行為並生成警報，而 IPS 不僅能夠檢測入侵行為，還能夠主動阻止攻擊，提供更全面的安全保護。



## usage
```
FIREWALL/IDS EVASION AND SPOOFING:
  -f; --mtu <val>: fragment packets (optionally w/given MTU)
  -D <decoy1,decoy2[,ME],...>: Cloak a scan with decoys
  -S <IP_Address>: Spoof source address
  -e <iface>: Use specified interface
  -g/--source-port <portnum>: Use given port number
  --proxies <url1,[url2],...>: Relay connections through HTTP/SOCKS4 proxies
  --data <hex string>: Append a custom payload to sent packets
  --data-string <string>: Append a custom ASCII string to sent packets
  --data-length <num>: Append random data to sent packets
  --ip-options <options>: Send packets with specified ip options
  --ttl <val>: Set IP time-to-live field
  --spoof-mac <mac address/prefix/vendor name>: Spoof your MAC address
  --badsum: Send packets with a bogus TCP/UDP/SCTP checksum
```







## -f（分片資料包）； --mtu（使用指定的MTU）

```
這段說明了 `-f` 和 `--mtu` 選項的作用和影響，重點如下：

1. **-f 選項**：將封包分片成微小的碎片 IP 封包，使得資料包過濾器、
入侵偵測系統等更難偵測到掃描行為。指定此選項後，Nmap 將將封包分割成 8 個或更少的位元組，
使得 TCP 標頭被分成多個資料包，提高逃避檢測的成功率。

2. **--mtu 選項**：用於指定特定的 MTU（最大傳輸單元）值，
以確保封包大小不超過目標網絡的 MTU 大小，從而降低分段的概率。

3. **注意事項**：小心使用 `-f` 選項，因為某些程式在處理這些小資料包時可能會遇到困難。
同時，碎片資料包可能會導致性能損失，因此在某些情況下需要停用或調整相關設置。

4. **支持的功能**：僅原始資料包功能支援分段，包括 TCP 和 UDP 連接埠掃描和作業系統偵測等，
而版本偵測和 Nmap 腳本引擎等功能通常不支援碎片。

-f
將探索封包分段成許多較小的8位組的封包資料來傳送，這個切割封包傳送的做法對現今的防火牆而言並沒有太大的效用
將封包分割成 8 個或更少的位元組。因此 20 位元組的 TCP 標頭將被分成三個資料包
對現今的防火牆而言並沒有太大的效用，不過對於一些老舊或設定不當防火牆仍可能產生一些規避的效果

sudo nmap -f  192.168.50.46

sudo nmap -f  192.168.50.46


--mtu (MTU必需是八的倍數)
sudo nmap  --mtu=16 192.168.50.46


```

## -D
```
-D 選項可以直接在選項後輸入要偽裝的IP群
請注意，用作誘餌的主機應該處於啟動狀態，否則您可能會意外地對目標進行 SYN 淹沒
假的 IP 地址和真實的 MAC 地址是一致的。
記住他也會使用真實的IP來探測，所以不是真的偽造，而是藏在一堆IP裡面而已

sudo nmap -D 192.168.50.2,192.168.50.3   192.168.50.46 -p80


RND:10 來指定的，這表示Nmap將隨機生成10個IP地址
sudo nmap -D RND:10 192.168.50.46 -p80



```


## -S (偽造源IP地址)

在某些情況下，Nmap 可能無法確定您的來源位址（如果是這種情況，Nmap 會告訴您）。在這種情況下，請使用-S您希望透過其傳送封包的介面的 IP 位址。

該標誌的另一種可能用途是欺騙掃描，使目標認為其他人正在掃描它們。想像一下一家公司被競爭對手反覆進行連接埠掃描！此類用途通常需要選項 -e和。-Pn請注意，您通常不會收到回覆封包（它們將發送到您正在欺騙的 IP），因此 Nmap 不會產生有用的報告。


```
失敗，加上-e -Pn 也沒用
failed to determine route to xxxx
```


## -g/--source-port 
指定使用來源端口，但無法隨機

```
sudo nmap -g 12345 192.168.50.46 -p80
sudo nmap -g 12345 192.168.50.46 -p80 -D 10.1.2.3
```


## --data <十六进制字符串> (在发送的报文中附加自定义二进制数据)

```
这个选项可以让你在发送的数据包中包含二进制数据作为有效载荷。<十六进制字符串>可以用以下任何一种格式指定。0xAABBCCDDEEFF<...>, AABBCCDDEEFF<...> 或 \xAA\xBB\xCC\xDD\xEE\xFF<...>。使用的例子有--data 0xdeadbeef and --data \xCA\xFE\x09。请注意，不会进行字节大小端转换。确保你以接收者期望的字节顺序指定信息。


nmap -sU   -p80 192.168.50.46 --data 0x5363616E
#发送一个"Scan"字符串到192.168.50.46主机
```


## --data-string < string > (在发送的数据包中添加自定义字符串)
    
```
这个选项可以让你在发送的数据包中包含一个常规的字符串作为有效载荷。
<string>可以包含任何字符串。然而，请注意，一些字符可能取决于你的系统的本地语言，
接收器可能不会看到相同的信息。另外，请确保你用双引号将字符串括起来，
并在shell中转义任何特殊字符。

例子。--data-string "Scan conducted by Security Ops, extension 7192" 或者 --data-string "Ph34r my l33t skills". 

请记住，没有人可能真正看到这个选项留下的任何字符串信息，除非他们使用嗅探器或自定义IDS规则仔细监控网络。

    
sudo nmap -sU  192.168.50.46 --max-retries=0 --data-string "Scan conducted by Security Ops, extension 7192" -p80

 sudo nmap  192.168.50.46 --max-retries=0 --data-string "Scan conducted by Security Ops, extension 7192" -p80


```

## --ip-options
很矇不知道在幹嘛~~~~


--ip-options 用於在 IP 選項字段中添加自定義數據。以下是其用法的示例：

1. 直接指定十六進制值作為參數：
   ```
   --ip-options "\x01\x02\x03\x04"
   ```

2. 重複某些字符：
   ```
   --ip-options "\x01\x02\x03\x04*10"
   ```

3. 使用快捷方式指定選項：
   ```
   --ip-options "R"   # 請求記錄路由
   --ip-options "T"   # 請求記錄時間戳
   --ip-options "U"   # 請求記錄路由和時間戳
   ```

4. 指定鬆散或嚴格的源路由：
   ```
   --ip-options "L 192.168.1.1"    # 鬆散源路由到 192.168.1.1
   --ip-options "S 192.168.1.1"    # 嚴格源路由到 192.168.1.1
   
    sudo  nmap -n -sn -PE --ip-options "L 10.10.6.60"  192.168.50.46 --disable-arp-ping 
   ```

這些用法可根據需要組合使用，以添加指定的 IP 選項到掃描中的封包中。







## --spoof-mac

```
先查看本機MAC
ip link show
00:0c:29:07:7f:XX

# apple
sudo nmap -sS   -p80 --spoof-mac  Apple 192.168.50.46 --max-retries=0

# Cisco
sudo nmap -sS   -p80 --spoof-mac Cisco 192.168.50.46 --max-retries=0

# 0代表隨機
sudo nmap -sS   -p80 --spoof-mac 0 192.168.50.46 --max-retries=0


#asus 
sudo nmap -sS   -p80 --spoof-mac asus 192.168.50.46 --max-retries=0

#在加上-D
sudo nmap -sS   -p80 --spoof-mac asus 192.168.50.46 --max-retries=0 -D 8.8.8.8

```

