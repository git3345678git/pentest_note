# Nmap 主機發現

## 資源:
```
https://svn.nmap.org/nmap/docs/nmap.usage.txt
https://nmap.org/book/man-nse.html
https://www.keepnight.com/archives/1423/
```


## 這是一小段使用
```
HOST DISCOVERY:
  -sL: List Scan - simply list targets to scan
  -sn: Ping Scan - disable port scan
  -Pn: Treat all hosts as online -- skip host discovery
  -PS/PA/PU/PY[portlist]: TCP SYN, TCP ACK, UDP or SCTP discovery to given ports
  -PE/PP/PM: ICMP echo, timestamp, and netmask request discovery probes
  -PO[protocol list]: IP Protocol Ping
  -n/-R: Never do DNS resolution/Always resolve [default: sometimes]
  --dns-servers <serv1[,serv2],...>: Specify custom DNS servers
  --system-dns: Use OS's DNS resolver
  --traceroute: Trace hop path to each host
```






## 這邊首先要介紹 -sn 跟 -Pn


- `-sn`：该参数用于指示 Nmap 在进行扫描时不执行端口扫描，仅进行主机发现。这意味着 Nmap 将仅确定哪些主机是在线的，而不会尝试确定它们的端口状态。适用于需要快速确定网络上在线主机的情况，而不关心它们的开放端口。

- `-Pn`：该参数用于指示 Nmap 在进行扫描时不进行主机发现，而是直接对所有目标主机执行端口扫描。这意味着 Nmap 将假定所有目标主机都是在线的，并尝试确定它们的端口状态。适用于已知目标主机在线的情况，但不确定它们是否会响应 ping 请求。

因此，`-sn` 适用于需要进行主机发现但不进行端口扫描的情况，而 `-Pn` 适用于已知目标主机在线但不确定其是否会响应 ping 请求的情况。




## 大坑

官方雖然有講，但他嗎的寫的很小，文檔又很長。
至於個別功能，我這邊就不寫了，我一定會忘。

```
如果你想使用
-PS/PA/PU/PY  (這四個可以加上 port -PS80,443 -PS22-25)
-PE/PP/PM (icmp 類)
-PO 1 2 4 6 17 132
加上
必須加上 --disable-arp-ping，否則會一直使用 arp 發現


sudo nmap -sn -PS22-25 192.168.50.46 --disable-arp-ping 
sudo nmap -sn -PS80,443 192.168.50.46 --disable-arp-ping 




使用了全部的發現4個
sudo nmap -sn -PS -PA -PU -PY  -PE -PP -PM -PO 192.168.50.0/24 --disable-arp-ping 


純用 arp 發現5個
sudo nmap -sn 192.168.50.0/24



不過不能這樣比較，因為有些選項可以繞過防火牆，或過濾機制，發現主機。
有些是基於icmp 有些是 tcp or udp



IP 数据包的协议列表。您可以列出要探测的多个协议，用逗号分隔。例如，如果您想要探测 ICMP、IGMP 和 IP-in-IP 协议，
-PO1 2 4 6 17 132
sudo nmap -sn -PO1 192.168.50.46  --disable-arp-ping
sudo nmap -sn -PO2 192.168.50.46 --disable-arp-ping




```


## 端口狀態

### open
```
開放
```

### closed
```
關閉的連接埠可以存取（它接收並回應 Nmap 探測資料包），但沒有應用程式偵聽該連接埠
由於關閉的連接埠是可存取的，因此可能值得稍後掃描
```


### filtered
```
過濾可以來自專用防火牆設備
路由器規則或基於主機的防火牆軟體
這些連接埠讓攻擊者感到沮喪

```

### unfiltered
```
意味著連接埠可以訪問

無法確定該連接埠是開啟還是關閉

只有用於對應防火牆規則集的 ACK 掃描才會將連接埠分類為此狀態

其他掃描類型（例如視窗掃描、SYN 掃描或 FIN 掃描）掃描未過濾的連接埠可能有助於確定連接埠是否已開啟
```


### open|filtered
```
無法確定連接埠是開放還是已過濾
對於開放連接埠沒有回應的掃描類型，會發生這種情況
缺乏響應也可能意味著資料包過濾器丟棄了探測或其引發的任何響應
UDP、IP 協定、FIN、NULL 和 Xmas 掃描 會出現這種情況
```

### closed|filtered
```
当Nmap在进行IP ID空闲扫描时，如果无法确定目标主机上的端口是关闭的还是被过滤的，
就会将这些端口标记为 "closed|filtered" 状态。
这种状态表示Nmap无法确定端口的确切状态，
可能是因为目标主机对所有端口的扫描请求采取了相同的响应方式，
无论端口是关闭还是被过滤
```