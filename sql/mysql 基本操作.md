




##  忘记了 MariaDB 的 root 用户的密码，你可以尝试通过以下步骤重置密码：

1. 首先，停止 MariaDB 服务：

```
sudo systemctl stop mariadb
```

2. 接下来，使用以下命令启动 MariaDB 服务，并跳过权限验证：

```
sudo mysqld_safe --skip-grant-tables --skip-networking &
```

3. 连接到 MariaDB 数据库：

```
mysql -u root
```

4. 在 MariaDB 命令行界面中，使用以下 SQL 查询来重置 root 用户的密码：

```sql
FLUSH PRIVILEGES;
ALTER USER 'root'@'localhost' IDENTIFIED BY '新密码';
```


5. 完成后，退出 MariaDB 命令行界面，并停止 MariaDB 服务：

```
quit;
sudo systemctl stop mariadb
```

6. 最后，重新启动 MariaDB 服务：

```
sudo systemctl start mariadb
```




## 基本查看操作
```
-- 登录到 MySQL 数据库，使用 root 用户
mysql -u root -p





--查看所有使用者密碼
SELECT User, Host, Password FROM mysql.user;

+-------------+-----------+-------------------------------------------+
| User        | Host      | Password                                  |
+-------------+-----------+-------------------------------------------+
| mariadb.sys | localhost |                                           |
| root        | localhost | *81F5E21E35407D884A6CD4A731AEBFB6AF209E1B |
| mysql       | localhost | invalid                                   |
| dvwa        | localhost | *D7E39C3AF517EC9EF7086223B036E0B4F22821F8 |
+-------------+-----------+-------------------------------------------+


-- 显示所有数据库
SHOW DATABASES;

+--------------------+
| Database           |
+--------------------+
| dvwa               |
| information_schema |
| mysql              |
| performance_schema |
| sys                |
+--------------------+



-- 选择 DVWA 数据库
USE dvwa;




-- 显示 DVWA 数据库中的所有表
SHOW TABLES;


+----------------+
| Tables_in_dvwa |
+----------------+
| guestbook      |
| users          |
+----------------+


-- 显示 users guestbook 表的结构
DESCRIBE users;
DESCRIBE guestbook;

-- 或者
SHOW COLUMNS FROM users;
SHOW COLUMNS FROM guestbook;


+--------------+-------------+------+-----+---------------------+-------------------------------+
| Field        | Type        | Null | Key | Default             | Extra                         |
+--------------+-------------+------+-----+---------------------+-------------------------------+
| user_id      | int(6)      | NO   | PRI | NULL                |                               |
| first_name   | varchar(15) | YES  |     | NULL                |                               |
| last_name    | varchar(15) | YES  |     | NULL                |                               |
| user         | varchar(15) | YES  |     | NULL                |                               |
| password     | varchar(32) | YES  |     | NULL                |                               |
| avatar       | varchar(70) | YES  |     | NULL                |                               |
| last_login   | timestamp   | NO   |     | current_timestamp() | on update current_timestamp() |
| failed_login | int(3)      | YES  |     | NULL                |                               |
+--------------+-------------+------+-----+---------------------+-------------------------------+




-- 显示 users 表中的所有数据
SELECT * FROM users;

-- 显示 guestbook 表中的所有数据
SELECT * FROM guestbook;

-- 或者 單一欄位
SELECT user_id FROM users;


+---------+------------+-----------+---------+----------------------------------+----------------------------------+---------------------+--------------+
| user_id | first_name | last_name | user    | password                         | avatar                           | last_login          | failed_login |
+---------+------------+-----------+---------+----------------------------------+----------------------------------+---------------------+--------------+
|       1 | admin      | admin     | admin   | 5f4dcc3b5aa765d61d8327deb882cf99 | /DVWA/hackable/users/admin.jpg   | 2023-06-29 10:02:01 |            0 |
|       2 | Gordon     | Brown     | gordonb | e99a18c428cb38d5f260853678922e03 | /DVWA/hackable/users/gordonb.jpg | 2023-06-29 10:02:01 |            0 |
|       3 | Hack       | Me        | 1337    | 8d3533d75ae2c3966d7e0d4fcc69216b | /DVWA/hackable/users/1337.jpg    | 2023-06-29 10:02:01 |            0 |
|       4 | Pablo      | Picasso   | pablo   | 0d107d09f5bbe40cade3de5c71e9e9b7 | /DVWA/hackable/users/pablo.jpg   | 2023-06-29 10:02:01 |            0 |
|       5 | Bob        | Smith     | smithy  | 5f4dcc3b5aa765d61d8327deb882cf99 | /DVWA/hackable/users/smithy.jpg  | 2023-06-29 10:02:01 |            0 |
+---------+------------+-----------+---------+----------------------------------+----------------------------------+---------------------+--------------+

```



## 添加使用者


要向 MySQL 或 MariaDB 数据库中添加用户，你可以使用 `CREATE USER` 命令。以下是一个示例：

```sql
CREATE USER 'username'@'hostname' IDENTIFIED BY 'password';
```

在这个命令中：

- `username` 是你要创建的用户名。
- `hostname` 是允许该用户登录的主机名。通常使用 `'%'` 表示允许所有主机访问，或者使用具体的主机名表示只允许特定主机访问。
- `password` 是该用户的密码。

例如，要创建一个名为 `newuser`，密码为 `password123`，并允许任何主机访问的用户，你可以执行以下命令：

```sql
CREATE USER 'newuser'@'%' IDENTIFIED BY 'password123';
```

如果你想要限制该用户只能从特定的主机登录，可以将 `'%'` 替换为该主机的名称或 IP 地址。例如，如果只允许来自本地主机的登录，你可以将主机名设置为 `'localhost'`：

```sql
CREATE USER 'newuser'@'localhost' IDENTIFIED BY 'password123';
```

创建用户后，你可能还需要为该用户分配适当的权限。通常，新用户会被分配默认权限，你可以根据需要随后调整这些权限。




## 調整使用者對資料庫的權限


要添加用户并调整其权限，你可以按照以下步骤进行：



1. **分配权限**：使用 `GRANT` 命令分配用户权限。例如，如果你想要授予用户对所有数据库的所有权限，可以使用以下命令：

```sql
GRANT ALL PRIVILEGES ON *.* TO 'username'@'hostname';
```

如果你只想授予用户对特定数据库的权限，可以将 `*.*` 替换为数据库名和表名。例如，要授予用户对 `dvwa` 数据库的所有权限，可以使用以下命令：

```sql
GRANT ALL PRIVILEGES ON dvwa.* TO 'username'@'hostname';
```

2. **刷新权限**：在修改用户权限后，需要刷新数据库的权限表，以使更改生效。可以使用以下命令：

```sql
FLUSH PRIVILEGES;
```

这样，你就创建了一个新用户并为其分配了相应的权限。请注意，为了执行上述操作，你需要具有足够的权限，通常是 `CREATE USER` 和 `GRANT` 权限。




## 查看權限

要查看 MySQL 或 MariaDB 数据库中的用户权限，可以使用 `SHOW GRANTS` 命令。例如，要查看用户 `username` 的权限，可以执行以下命令：

```sql
SHOW GRANTS FOR 'dvwa'@'localhost';


+-------------------------------------------------------------------------------------------------------------+
| Grants for dvwa@localhost                                                                                   |
+-------------------------------------------------------------------------------------------------------------+
| GRANT USAGE ON *.* TO `dvwa`@`localhost` IDENTIFIED BY PASSWORD '*D7E39C3AF517EC9EF7086223B036E0B4F22821F8' |
| GRANT ALL PRIVILEGES ON `dvwa`.* TO `dvwa`@`localhost`                                                      |
+-------------------------------------------------------------------------------------------------------------+


```

将 `'username'` 替换为要查看权限的用户名，`'hostname'` 替换为用户登录的主机名（例如 `'%'` 表示所有主机）。

如果你要查看所有用户的权限，可以执行以下命令：

```sql
SELECT User, Host, Grant_priv, Super_priv FROM mysql.user;

+-------------+-----------+------------+------------+
| User        | Host      | Grant_priv | Super_priv |
+-------------+-----------+------------+------------+
| mariadb.sys | localhost | N          | N          |
| root        | localhost | Y          | Y          |
| mysql       | localhost | Y          | Y          |
| dvwa        | localhost | N          | N          |
+-------------+-----------+------------+------------+

```

这将显示每个用户的用户名、主机名以及他们是否具有 `GRANT` 和 `SUPER` 权限。你还可以选择查看其他权限列，具体取决于你想了解的信息。


| 权限       | 描述                                                         |
|------------|--------------------------------------------------------------|
| GRANT      | 允许用户授予和管理其他用户的权限。                           |
| SUPER      | 启动、停止或重启服务器，设置全局系统变量，执行备份和恢复操作     |







## mariadb 錯誤

錯誤訊息:
```
Job for mariadb.service failed because the control process exited with error code.
See "systemctl status mariadb.service" and "journalctl -xeu mariadb.service" for details.

```

解決:
https://talk.plesk.com/threads/db-query-failed-sqlstate-hy000-2002-no-such-file-or-directory-mariadb-cant-start.373031/

```
mv /var/lib/mysql/ib_logfile0 /var/lib/mysql/ib_logfile0.bak

systemctl start mariadb.service

systemctl status mariadb.service
```











