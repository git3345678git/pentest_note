# 域名泛解析

### 一、什麼是泛解析？

泛解析是指使用通配符 * （星號）來設定所有的子域名都指向同一個IP地址。

例如，如果您的域名是 example.com，設置一個 *.example.com 的次級域名A記錄指向 111.111.111.111，那麼不論訪問者輸入的是：

- 「123.example.com」
- 「abc.example.com」
- 或者其他任意字符組成的子域名，

都會導向到 IP 地址為 111.111.111.111。

### 二、泛解析和域名解析的區別

泛域名解析和域名解析有何不同？

- **域名泛解析**：*.域名解析到同一IP。
- **域名解析**：子域名.域名解析到同一IP。

請注意：只有在您的空間是獨立IP的情況下，泛域名才有意義。而域名解析則沒有此要求。

### 三、泛域名解析的用途

1. **無限子域名擴展**：泛解析讓主域名支持無限的子域名擴展。
2. **避免誤操作**：避免因設置域名解析而導致網站無法訪問的情況。
3. **簡潔的網址**：讓直接輸入網址的用戶可以使用簡潔的網址訪問網站。

泛解析在實際場景中的應用非常廣泛，例如實現無限二級域名功能、提供免費的URL轉發、在IDC部門實現自動分配網址以及在大型企業中實現網址分類管理功能等。

### 四、泛域名解析的操作步驟

與域名解析一樣，點擊「高級解析服務」，選擇類型為「A記錄」，並填寫「RR」值為「*」號，輸入指向的IP地址「值」。泛解析中該值必須為獨立IP，即通過IP可訪問站點。







# 繞過方法

泛解析只對於暴力枚舉不好用，還是可以依照很多其他蒐集方式進行，但爆破也不昰不行，只是麻煩了點




## 黑名单 IP
泛解析一直都是域名爆破中的大問題。我們目前的解決思路是根據一個不存在的子域名的解析IP來記錄黑名單IP。在爆破字典時，如果解析的IP在這個黑名單中，則默認跳過；如果不存在，則將其加入到數據庫中。

假設有一個域名example.com A 1.1.1.1。
解決思路是根據一個不存在的子域名的解析IP來獲取黑名單IP。
假設不存在的子域名 a123xyz.example.com，它的解析IP也是1.1.1.1。

在這種情況下，1.1.1.1會被加入黑名單中。當你們爆破字典時，如果解析的IP地址為1.1.1.1，則會直接跳過，因為它在黑名單中。

然而，這裡存在一個問題。假如這個子域名 a123xyz.example.com 實際上是一個合法的網站，而不僅僅是一個不存在的子域名。這樣過濾方法就會導致誤報，將一個合法的網站誤認為是泛解析，而將其IP地址加入黑名單。





## TTL来做判断

### 複習:

TTL（Time to Live）設置通常可以應用於以下類型的DNS記錄：

1. A記錄：將域名指向IPv4地址。
2. AAAA記錄：將域名指向IPv6地址。
3. CNAME記錄：將域名指向另一個域名。
4. MX記錄：指定郵件交換服務器。
5. NS記錄：指定該域名的DNS伺服器。
6. TXT記錄：存儲任意文本信息。
7. PTR記錄：將IP地址指向域名。
8. SRV記錄：指定服務的位置，如聊天服務或語音通話服務。

不同的DNS記錄類型可能具有不同的TTL設置選項，但通常您可以在DNS設置中為每個記錄類型指定TTL值。這使得您可以根據您的需求和預期的DNS記錄變更頻率來設置不同的TTL值。



### 舉例:


當您在域名設置中設置了A記錄並指定了TTL，以8.8.8.8作為DNS解析器的情況下，讓我舉個例子來說明：

假設您將A記錄設置為：

- 主機名：example.com
- IP地址： 57.43.22.1 
- TTL：3600秒（1小時）

現在假設某人首次訪問 example.com。他的設備將會向其配置的DNS解析器，例如8.8.8.8，發送一個DNS查詢請求，詢問域名 example.com 的IP地址。

如果在8.8.8.8的緩存中沒有這個查詢的結果，8.8.8.8將會向域名 example.com 的權威DNS服務器發送一個DNS查詢請求，以獲取對應的IP地址。

當權威DNS服務器回應這個查詢時，8.8.8.8將會收到域名 example.com 的IP地址 57.43.22.1 並將其返回給訪問者的設備。同時，8.8.8.8將會將這個查詢的結果存入緩存中，有效期為3600秒（1小時）。

在接下來的1小時內，如果有其他人訪問 example.com，他們的設備將直接從8.8.8.8的緩存中獲取域名對應的IP地址，而無需再次向權威DNS服務器發送請求。這樣就節省了對權威DNS服務器的查詢，提高了解析速度和效率。






## 繞過原理
假設有一個域名 example.com，設置了泛解析，所有的子域名都指向相同的IP地址 1.1.1.1。根據權威 DNS 的設置，這些泛解析記錄的 TTL 都是相同的，比如設置為 3600 秒（1 小時）。


現在，我們在爆破字典時遇到了以下情況：

1. 子域名 record1.example.com 的解析記錄指向 1.1.1.1，TTL 為 3600 秒。
2. 子域名 record2.example.com 的解析記錄也指向 1.1.1.1，但 TTL 為 1800 秒。
3. 子域名 record3.example.com 的解析記錄指向 1.1.1.1，TTL 為 3600 秒。

根據基於TTL的判斷方式：

- record1.example.com 和 record3.example.com 的 TTL 相同，且都與泛解析的 TTL 一致，因此它們可能是泛解析記錄。
- record2.example.com 的 TTL 與泛解析的 TTL 不一致，因此它很可能不是泛解析記錄。

因此，我們可以將 record2.example.com 的解析記錄排除在外，從而減少了誤報的可能性。





## 實戰


其實要針對站點具體分析，我自己找到的TTL會隨機跳所以無法驗證，但可以用A記錄來判斷 


子域名 隨便亂打
80123www08.eyny.com
456987www08.eyny.com 


NS查詢A記錄

```
dig A 80123www08.eyny.com

80123www08.eyny.com.    300     IN      CNAME   eyny.com.
eyny.com.               152     IN      A       52.117.224.158
eyny.com.               152     IN      A       52.117.224.148
eyny.com.               152     IN      A       52.117.224.146
eyny.com.               152     IN      A       52.117.224.157
eyny.com.               152     IN      A       52.117.224.149
eyny.com.               152     IN      A       172.241.24.66
eyny.com.               152     IN      A       172.241.24.65
eyny.com.               152     IN      A       169.60.163.103
eyny.com.               152     IN      A       172.241.24.22
eyny.com.               152     IN      A       172.241.24.20
eyny.com.               152     IN      A       52.117.224.156
eyny.com.               152     IN      A       52.117.224.151

```


```
dig A 456987www08.eyny.com

456987www08.eyny.com.   300     IN      CNAME   eyny.com.
eyny.com.               113     IN      A       52.117.224.148
eyny.com.               113     IN      A       172.241.24.66
eyny.com.               113     IN      A       172.241.24.22
eyny.com.               113     IN      A       52.117.224.146
eyny.com.               113     IN      A       52.117.224.157
eyny.com.               113     IN      A       172.241.24.65
eyny.com.               113     IN      A       169.60.163.103
eyny.com.               113     IN      A       172.241.24.20
eyny.com.               113     IN      A       52.117.224.149
eyny.com.               113     IN      A       52.117.224.151
eyny.com.               113     IN      A       52.117.224.158
eyny.com.               113     IN      A       52.117.224.156

```

可以發現兩筆都昰 先一筆 cname 到eyny.com 
eyny.com 有12筆 A記錄，且IP都相同。


這昰有效的子域名，可以看到 cname為空 ， A記錄一筆 52.117.224.147
```
dig cname a01.eyny.com 
a01.eyny.com.                  IN      CNAME

dig A a01.eyny.com 
a01.eyny.com.           65      IN      A       52.117.224.147
```





為了確保誤判，最好不要只依靠一種記錄類型，

可以先判斷cname 是否為一筆 是否昰eyny.com 

在判斷A記錄 是否為12筆 假設不昰12筆，就可能有效，假設為12筆是否IP完全一模一樣。

完全一模一樣就等於無效子域。





