
# massdns

- 通常搭配 dnsvalidator + dnsfaster 效果更好。
- 先dnsvalidator 驗證有效的解析器
- 再dnsfaster 篩選快速的dns解析器

有了正确 DNS 服务器列表后，可以直接使用工具解析 IP，要注意的是在解析域名时一定要指定 DNS 服务器列表，并降低 QPS，防止被 Ban。这里有 massdns、dnsx、zdns、puredns、shuffledns 可以使用，下面主要介绍 massdns


## 建議從官方下載，使用。kali自帶的有些文件不知道在哪。
安裝
```
git clone  https://github.com/blechschmidt/massdns.git
cd massdns  
make   
sudo make install 
```

## 用法
```
用法：massdns [选项] [域列表]
   -b --bindto 绑定到IP地址和端口。 （默认值：0.0.0.0:0）
       --busy-poll 使用忙等待轮询而不是 epoll。
   -c --resolve-count 放弃之前名称的解析次数。 （默认值：50）
       --drop-group 以 root 身份运行时要删除权限的组。 （默认值：无组）
       --drop-user 以 root 身份运行时要删除权限的用户。 （默认值：无人）
       --filter 只输出具有指定响应代码的数据包。
       --flush 每当收到响应时刷新输出文件。
   -h --help 显示此帮助。
       --ignore 不输出具有指定响应代码的数据包。
   -i --interval 同一事件的多个解析之间等待的时间间隔（以毫秒为单位）
                          领域。 （默认值：500）
   -l --error-log 错误日志文件路径。 （默认：/dev/stderr）
       --norecurse 使用非递归查询。 对于 DNS 缓存侦听很有用。
   -o --output 输出格式化标志。
       --predictable 增量使用解析器。 对于解析器测试很有用。
       --processes 用于解析的进程数。 （默认值：1）
   -q --quiet 安静模式。
       --rcvbuf 接收缓冲区的大小（以字节为单位）。
       --retry 不可接受的 DNS 响应代码。 （默认：拒绝）
   -r --resolvers 包含 DNS 解析器的文本文件。
       --root 当以 root 身份运行时不要放弃权限。 不建议。
   -s --hashmap-size 并发查找数。 （默认值：10000）
       --sndbuf 发送缓冲区的大小（以字节为单位）。
       --status-format 实时状态更新的格式，json 或 ansi（默认：ansi）
       --sticky 重试时不要切换解析器。
       --socket-count 每个进程的套接字计数。 （默认值：1）
   -t --type 要解析的记录类型。 （默认值：A）
       --verify-ip 验证传入回复的 IP 地址。
   -w --outfile 写入指定的输出文件而不是标准输出。

输出标志：
   S - 简单文本输出
   F——全文输出
   B——二进制输出
   J - ndjson 输出

简单输出模式的高级标志：
   d - 包括附加部分中的记录。
   i - 缩进任何回复记录。
   l - 使用换行符分隔回复。
   m - 只输出与问题名称匹配的回复记录。
   n - 包括答案部分的记录。
   q - 打印问题。
   r - 打印问题，并在前面添加解析器 IP 地址、Unix 时间戳和返回代码。
   s - 使用换行符分隔数据包部分。
   t - 在输出中包含 TTL 和记录类别。
   u - 包括来自权威部分的记录。
```



## mp64先產生字典
```
mp64 ww?l.toho-leo.com > ~/Desktop/domains.txt

wwa.toho-leo.com
wwb.toho-leo.com
wwc.toho-leo.com
wwd.toho-leo.com
wwe.toho-leo.com
wwf.toho-leo.com
wwg.toho-leo.com
wwh.toho-leo.com
wwi.toho-leo.com
wwj.toho-leo.com
wwk.toho-leo.com
wwl.toho-leo.com
wwm.toho-leo.com
wwn.toho-leo.com
wwo.toho-leo.com
wwp.toho-leo.com
wwq.toho-leo.com
wwr.toho-leo.com
wws.toho-leo.com
wwt.toho-leo.com
wwu.toho-leo.com
wwv.toho-leo.com
www.toho-leo.com
wwx.toho-leo.com
wwy.toho-leo.com
wwz.toho-leo.com
                   
```





## 基本使用(輸出詳細)
```
 ./bin/massdns -r ~/Desktop/fast_dns_ip_list.txt  -t A   -w ~/Desktop/results.txt ~/Desktop/domains.txt

```



## 解析的status 
```
Response: | Success:               | Total:
OK:       |            2 (  7.69%) |            3 (  7.69%)
NXDOMAIN: |           24 ( 92.31%) |           33 ( 84.62%)
SERVFAIL: |            0 (  0.00%) |            0 (  0.00%)
REFUSED:  |            0 (  0.00%) |            3 (  7.69%)
FORMERR:  |            0 (  0.00%) |            0 (  0.00%)


"OK": 成功的查詢，即成功找到了相應的 DNS 記錄。在兩個查詢中有 2 個 (7.69%) 是成功的。

"NXDOMAIN": 域名不存在的查詢結果，即找不到相應的 DNS 記錄。在 33 個查詢中有 24 個 (92.31%) 是 NXDOMAIN。

"SERVFAIL": 服務器錯誤的查詢結果，即 DNS 服務器無法處理該查詢。在這次統計中沒有 SERVFAIL 的結果。

"REFUSED": 拒絕查詢的結果，即 DNS 服務器拒絕處理該查詢。在 39 個查詢中有 3 個 (7.69%) 是 REFUSED。

"FORMERR": 格式錯誤的查詢結果，即 DNS 查詢的格式有誤。在這次統計中沒有 FORMERR 的結果。

```




## 打印輸出
```
cat results.txt



;; Server: 156.154.71.25:53
;; Size: 64
;; Unix time: 1709445264
;; ->>HEADER<<- opcode: QUERY, status: NOERROR, id: 57115
;; flags: qr rd ra ; QUERY: 1, ANSWER: 2, AUTHORITY: 0, ADDITIONAL: 0

;; QUESTION SECTION:
www.toho-leo.com. IN A

;; ANSWER SECTION:
www.toho-leo.com. 3600 IN CNAME toho-leo.com.
toho-leo.com. 3600 IN A 74.207.252.187
```



## 簡單格式使用(推薦)
```
./bin/massdns -r ~/Desktop/fast_dns_ip_list.txt -t A -o S -w ~/Desktop/results.txt ~/Desktop/domains.txt





-r 這個選項指定了要使用的 DNS 解析器列表的文件路徑。

-t A：這個選項指定了查詢的類型，這裡是 A 類型查詢，用於查詢主機的 IPv4 地址。

-o S：這個選項指定了結果的輸出格式，這裡是 S，表示結果將以單行的格式輸出。


```

## 打印輸出
```
cat results.txt               
www.toho-leo.com. CNAME toho-leo.com.
```


## 簡單格式的進階輸出(推薦)
```
./bin/massdns -r lists/resolvers.txt -t A  -o St ~/Desktop/domains.txt -w ~/Desktop/results.txt


cat results.txt

www.toho-leo.com. IN 3600 CNAME toho-leo.com.
toho-leo.com. IN 600 A 74.207.252.187
```






## MassDNS 包含一個 `ptr.py` 腳本，

可讓您透過將各自的查詢列印到標準輸出來解析所有 IPv4 PTR 記錄。

就是爆破所有IP，然後找到domain

```
./scripts/ptr.py | ./bin/massdns -r lists/resolvers.txt -t PTR -w ptr.txt


ptr.py 的大制原理就是把IP  192.0.2.1  -> 1.2.0.192.in-addr.arpa

ptr.py是把IP 0.0.0.0 - 255.255.255.255 轉換


PTR 记录：PTR 记录是用于将 IP 地址解析为域名的 DNS 记录类型。
通常，PTR 记录用于执行反向 DNS 查询，
即从 IP 地址查找域名。例如，给定 IP 地址 192.0.2.1，
对应的 PTR 记录可能是 1.2.0.192.in-addr.arpa。

丟 1.2.0.192.in-addr.arpa 給 massdns
```




## 透過暴力破解子域進行偵察

負責任地執行偵察掃描並調整-s參數，以免壓垮權威名稱伺服器。

官方自帶的`subbrute.py` 功能很簡單，就是把 `example.com` 加上字典清單便成 `www.example.com`
```
 ./scripts/subbrute.py example.com ~/Desktop/names.txt | ./bin/massdns -r lists/resolvers.txt -t A -o S -w ~/Desktop/results.txt
 
 

 ./scripts/subbrute.py example.com ~/Desktop/names.txt：

这部分命令会执行一个名为 subbrute.py 的 Python 脚本，该脚本用于进行子域名爆破。命令的第一个参数 example.com 表示要爆破的主域名，第二个参数 ~/Desktop/names.txt 是一个文件路径，其中包含了用于爆破的子域名列表。
管道 |：


管道操作符 | 用于将 subbrute.py 的输出作为下一个命令的输入。
./bin/massdns -r lists/resolvers.txt -t A -o S -w ~/Desktop/results.txt：


这是一个 massdns 命令，用于执行 DNS 查询。
-r lists/resolvers.txt 指定了一个解析器列表的文件路径，这些解析器将用于执行 DNS 查询。
-t A 指定了要查询的记录类型，这里是 A 记录，用于查找主机的 IPv4 地址。
-o S 指定了输出格式为单行格式。
-w ~/Desktop/results.txt 指定了结果输出的文件路径，查询结果将写入到该文件中。
```






## 從crt.shct.py中抓取數據，憑證透明度日誌中提取子網域： (不推薦)
官方自帶的
```
./scripts/ct.py example.com | ./bin/massdns -r lists/resolvers.txt -t A -o S -w ~/Desktop/results.txt
```

我測出來是好像是不同網域，但因為是從證書查的，我沒研究兩者之間的關係
```
www.example.com. A 93.184.216.34
example.com. A 93.184.216.34
m.testexample.com. A 13.248.169.48
m.testexample.com. A 76.223.54.146

```


## 使用心得

只需要知道 massdns 的輸入是 domain 就可以了，剩下都隨便玩







## 關於PTR 的小實驗:


一般使用者通常沒有這個能力修改PTR紀錄，大多只能透過IPS業者或是出租空間的業者來達成此宣告。

詳細解說:
https://www.cjkuo.net/dns_ptr/


```
74.207.252.187 是共享IP

有以下網域
a-cha.com.tw	
amazing-tw.com.tw	
apaltec.com	
asianmusic.com.tw	
beautylynn.com	
carol-biotech.com.tw	
ccj9999.com	

---------------------------------------------------------------------
那我如果 187.252.207.74.in-addr.arpa 這樣會查到哪個


187.252.207.74.in-addr.arpa	PTR	li94-187.members.linode.com


li94-187.members.linode.com	 A	74.207.252.187





当您查询 187.252.207.74.in-addr.arpa 的 PTR 记录时，
您得到的结果是 li94-187.members.linode.com。
这是该 IP 地址的一个 PTR 记录，它通常是由 IP 地址的所有者或网络管理员设置的。


```