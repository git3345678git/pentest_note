# Amass


## 官方教學



```
https://github.com/owasp-amass/amass/blob/v3.22.2/doc/user_guide.md
https://github.com/owasp-amass/amass/blob/v3.22.2/doc/tutorial.md
```



## 小坑
amass 使用非常卡，換最新版都一樣，這可能出自於他的設計，amass 會自動發出很多請求，所以可能會被dns 解析器 8.8.8.8 判斷為異常留量，經過github 上的 issus 查看後，實驗加上 -r 多個解析器，可以解決問題

```
-r 8.8.8.8,1.1.1.1

-rf resolvers.txt

./amass enum -list -r 8.8.8.8  

amass intel -rf  ~/Desktop/fast_dns_ip_list.txt -whois -d example.com
```



## dnsvalidator (驗證有效resolvers)

```
dnsvalidator -tL https://public-dns.info/nameservers.txt -threads 20 -o  ~/Desktop/resolvers.txt
```


## dnsfaster (留下快速的 resolvers)

```
./dnsfaster -in=~/Desktop/resolvers.txt -workers=100 -tests=100 -domain="example.com" -out=~/Desktop/fast_dns_list.txt
```

## 抽取IP
```
grep -oE '([0-9]{1,3}\.){3}[0-9]{1,3}' fast_dns_list.txt   > fast_dns_ip_list.txt
```




## 版本差異

- 高版本信息比較多。但似乎很多功能都沒有。
- 我這邊推薦3.x版的，有加入 -src 參數。官方說4版還沒很成熟。 
- 然後推薦使用viz 子命令 結合maltego




## intel 子命令



關於 intel 命令我個人覺得非常不好用，有可能是我的source沒有自己調整API，而經過我的實驗後，reverse whois，也跟官方
https://github.com/owasp-amass/amass/blob/v3.22.2/doc/tutorial.md 這個效果不一樣了，應該是他去掉viewdns.info的src。

而我自己愛用的 reverse whois src 是 
https://www.whoxy.com/
https://viewdns.info/reversewhois/


但我看官方沒有配這兩個API，應該是要我們自己動手加入script 但沒研究過。
而且同樣命令，有時候有，有時候沒有。


```

# 不一定有效
./amass intel -rf  ~/Desktop/fast_dns_ip_list.txt -active -addr 104.21.69.132-135 -p 80,443

./amass intel -rf  ~/Desktop/fast_dns_ip_list.txt  -addr 104.21.69.132-135 

./amass intel -rf  ~/Desktop/fast_dns_ip_list.txt -whois -d tianshie.com -src



# -asn 可以用(結果會很大量)
./amass intel -rf  ~/Desktop/fast_dns_ip_list.txt  -asn 14061

# -cidr 可以用(結果會很大量)
./amass intel -rf  ~/Desktop/fast_dns_ip_list.txt -cidr 159.223.80.0/20




./amass intel -rf  ~/Desktop/fast_dns_ip_list.txt -ip -whois -d book123.info





./amass intel -rf  ~/Desktop/fast_dns_ip_list.txt -org Facebook

./amass intel -rf  ~/Desktop/fast_dns_ip_list.txt -cidr 104.154.0.0/15 -p 443,8080

./amass intel -rf  ~/Desktop/fast_dns_ip_list.txt -r 8.8.8.8,1.1.1.1 -whois -d 

./amass intel -rf  ~/Desktop/fast_dns_ip_list.txt -rf data/resolvers.txt -whois -d example.com

./amass intel -rf  ~/Desktop/fast_dns_ip_list.txt -src -whois -d example.com

./amass intel -rf  ~/Desktop/fast_dns_ip_list.txt -timeout 30 -d example.com

./amass intel -rf  ~/Desktop/fast_dns_ip_list.txt -v -whois -d example.com

./amass intel -rf  ~/Desktop/fast_dns_ip_list.txt -whois -d example.com





```







## enum 子命令

### 正常：執行 enum 子命令而不指定主動或被動標誌將從資料來源播種枚舉，並利用 DNS 來驗證結果並進一步調查範圍內的命名空間（提供的網域名稱）
```
./amass enum -rf  ~/Desktop/fast_dns_ip_list.txt -d  gogalgame.com -src -ip

[Baidu]           www.gogalgame.com 23.105.220.173
[CertSpotter]     gogalgame.com 23.105.220.173
[NSEC Walk]       autodiscover.gogalgame.com 198.54.122.136
[NSEC Walk]       mail.gogalgame.com 198.54.122.136
[NSEC Walk]       autoconfig.gogalgame.com 198.54.122.136
[DNS SRV]         _autodiscover._tcp.gogalgame.com 198.54.122.136


```

### 主動：它將執行所有正常模式並存取已發現的資產並嘗試取得 TLS 憑證、執行 DNS 區域傳輸、使用 NSEC 行走以及執行網路爬行。
```
 ./amass enum -rf  ~/Desktop/fast_dns_ip_list.txt -active  -d  gogalgame.com -p 80,443 -src -ip
 
[NSEC Walk]       autoconfig.gogalgame.com 198.54.122.136
[Baidu]           www.gogalgame.com 23.105.220.173
[DNS SRV]         _autodiscover._tcp.gogalgame.com 198.54.122.136
[NSEC Walk]       autodiscover.gogalgame.com 198.54.122.136
[NSEC Walk]       mail.gogalgame.com 198.54.122.136
[CertSpotter]     gogalgame.com 23.105.220.173

```


### 被動：只會從資料來源取得資訊並盲目接受。(沒有-src -ip)
```
 ./amass enum -rf  ~/Desktop/fast_dns_ip_list.txt -passive -d  gogalgame.com 
 
 
mail.gogalgame.com
autodiscover.gogalgame.com
r3dmcnfx.www.gogalgame.com
ipv6.gogalgame.com
gogalgame.com
autoconfig.gogalgame.com
_autodiscover._tcp.gogalgame.com
www.gogalgame.com
```

## DB
```
#查看DB 記錄索引
./amass db -list


#根據DB 記錄索引
./amass db -enum 1 -show
./amass db -enum 1 -show -ip -src




#所有域名混在一起(不好用)
./amass db -names 


# 顯示某個目標
./amass db -names -d gogalgame.com
./amass db -names -d gogalgame.com -ip -src
./amass db -names -d hanime1.me -ip -src



#顯示所有域名和 asn 總節 混在一起(不好用)
./amass db -show



# 顯示某個目標的域名和 asn 總節
./amass db -show -d gogalgame.com


# src ip + asn 總結
./amass db -show -src -ip -d gogalgame.com
./amass db -show -src -ip -d hanime1.me


# 只顯示 asn 總結
./amass db -summary -d gogalgame.com
./amass db -summary -d hanime1.me
```


## VIZ
```
# 產生 html 檔
./amass viz -d3 -d hanime1.me

# 要搭配線上軟體或其他才可以看，比較清楚
./amass viz -dot -d hanime1.me

# 使用db 索引號
./amass viz -enum 1 -d3 -d hanime1.me

# 是一种用于描述图形结构的 XML 文件格式
./amass viz -gexf -d hanime1.me

# Graphistry 是一个基于 Web 的数据分析和可视化平台
./amass viz -graphistry -d hanime1.me

# maltego 最好用
./amass viz -maltego -d hanime1.me

# -o 自定義輸出文件夾
./amass viz -d3 -o OUTPATH -d hanime1.me

# -oA 自定義命名文件
./amass viz -d3 -oA example -d hanime1.me
```

